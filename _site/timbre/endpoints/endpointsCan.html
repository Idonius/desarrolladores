<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <!-- syntax highlighting CSS -->
  <link rel="stylesheet" href="/css/syntax.css">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="/css/main.css">
  <!-- // <script src="http://syssgx.github.io/xml.js/js/xmllint.js"></script> -->
  <!-- // <script src="/scripts/bootstrap.min.js"></script> -->
  	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
	<script>window.jQuery || document.write('<script src="/scripts/jquery.min.js"><\/script>')</script>
	<script src="/scripts/bootstrap.min.js"></script>
<!--<script src="scripts/codemirror.js"></script>-->
    <!--<script src="scripts/searchcursor.js"></script>-->
    <!--<script src="scripts/match-highlighter.js"></script>-->
    <!--<script src="scripts/xml.js"></script>-->
	<!--<script src="scripts/prettify.js"></script>-->
	<!-- <script src="/scripts/xmllint.js"></script> -->
	<!-- // <script src="/scripts/script.js"></script> -->

  <link href="/favicon.ico" rel="shortcut icon" type="image/vnd.microsoft.icon" />

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-286386-31', 'auto');
    ga('send', 'pageview');
  </script>
  <title>servicio de cancelación cfdi-retenciones</title>
</head>

<body class="page-content page-columns-2">
  <a name="top" id="top"></a>
<div id="header-bg">
  <div id="bg-top"><div id="bg-top-left"></div></div>
  <div id="bg-fix"></div>
</div>
<div class="container" id="header">
  <div class="navbar">
    <div class="navbar-inner">
      <div class="container">
        <a id="logo" class="brand icon-logo-off" href="http://diverza.com"></a>
        <div class="nav-collapse">

          <ul class="menu nav">
            <li class="item-101">
              <a href="">Portada</a>
            </li>
            <li class="item-102">
              <a href="http://www.diverza.com/historia" >historia</a>
            </li>
            <li class="item-103">
              <a href="http://blog.diverza.com" >blog</a>
            </li>
            <li class="item-104">
              <a href="http://desarrolladores.diverza.com" id="stamp-navitem-selected">ecosistema</a>
            </li>
            <li class="item-105">
              <a href="http://www.diverza.com/contacto" >contacto</a>
            </li>
            <li class="item-106">
              <a href="http://www.diverza.com/soporte" >soporte</a>
            </li>
            <li class="item-107">
            <a href="http://www.diverza.com/acceso" >acceso</a>
            </li>
            <li id="colors-bar">
              <div class="color-bar color-bar-blue"></div>
              <div class="color-bar color-bar-yellow"></div>
              <div class="color-bar color-bar-green"></div>
              <div class="color-bar color-bar-red"></div>
            </li></ul>
          </div>
          <div class="nav-social">
            <ul class="menu-social">
              <li class="item-131"><a class="rss" href="http://feeds.feedburner.com/blog-diverza">RSS</a></li><li class="item-130"><a class="googleplus" href="https://plus.google.com/u/0/100935627964150268592/posts">Google Plus</a></li><li class="item-129"><a class="youtube" href="http://www.youtube.com/user/DiverzaTv?feature=mhee">YouTube</a></li><li class="item-128"><a class="facebook" href="http://www.facebook.com/pages/Diverza/350358341644324">Facebook</a></li><li class="item-127"><a class="twitter" href="http://twitter.com/diverza">Twitter</a></li></ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="container" id="header-brand-dummy"></div>
    <div id="header-brand">
      <div class="navbar container">
        <div class="navbar-inner">
          <div class="container">
            <div class="row">

              <div class="span2 nav-welcome ">
                <a href="/"><span class="welcome">desarrolladores<span class="diverza-dot">.</span></span></a>
              </div>

              <div class="nav-collapse-brand" id="menu-sub">
                <ul class="menu nav">
                  <li class="item-102" id="stamp-menu-item">
                    <a href="/timbre/">timbre fiscal</a>
                  </li>
                  <li class="item-103" id="conector-menu-item">
                    <a href="/conector/">conector fiscal</a>
                  </li>
                  <li class="item-104" id="docs-menu-item">
                    <a href="/documentos/">documentos</a>
                  </li>
                  <li class="item-105">
                    <a href="https://groups.google.com/forum/#!forum/diverza" target="_blank">grupos</a>
                  </li>
                  <li class="item-106">
                    <a href="https://github.com/diverza/desarrolladores" target="_blank">github</a>
                  </li>
                </ul>
              </div>
              <div class="nav-account">
                <div class="module">
                  <div class="custom">01.800.070.4000</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

  <style>
  #stamp-menu-item { color: #fff !important;
    background: #ddd;
    -webkit-box-shadow: inset 2px 2px 2px rgba(0, 0, 0, 0.25);
    -moz-box-shadow: inset 2px 2px 2px rgba(0, 0, 0, 0.25);
    -o-box-shadow: inset 2px 2px 2px rgba(0, 0, 0, 0.25);
    -ms-box-shadow: inset 2px 2px 2px rgba(0, 0, 0, 0.25);
    box-shadow: inset 2px 2px 2px rgba(0, 0, 0, 0.25);
    -webkit-border-radius: 20px;
    -moz-border-radius: 20px;
    -o-border-radius: 20px;
    -ms-border-radius: 20px;
    border-radius: 20px;
    text-shadow: 1px 1px rgba(0, 0, 0, 0.20);
    height: 35px;
    margin-top: 2px;
  }
</style>

<div id="body">
  <div class="container">
    <div id="main" class="row">
      <div id="content" class="span12">
        <div id="system-message-container">
        </div>
        <div id="component">
          <div class="item-pagepage-history">
            <div class="clr"></div>
            <div class="article-content-text">
              <h1>servicio de cancelación cfdi-retenciones<span class="diverza-dot">.</span></h1>
              <span class="h1-line"></span>
              <div class="clr">&nbsp;</div>
              <p><legend>
Esta documentación es para cancelar de CFDIs de retenciones.
<br />
Para cancelación de un comprobante normal de CFDI, ingrese <a href="../cancelacion/cancel-legacy.html">aquí</a>.
</legend></p>

<p>El servicio de cancelación consta de un servicio REST para cancelación de CFDIs timbrados ante el SAT, a partir del UUID del comprobante.</p>

<p>La siguiente guía explica cómo utilizar el servicio de cancelación, usando como ejemplo la <em>Terminal</em> o <em>Linea de comandos</em> y <em>cURL</em>.
<br>
Para un ambiente productivo, es indispensable contar con un CSD instalado en tu <a href="../cfd/timbreweb.html">cuenta web de <strong>Timbre Fiscal®</strong></a> ó <strong>Conector Fiscal®</strong>.
<br></p>

<p><strong>Cancelación de un comprobante a través del servicio REST: <br></strong></p>

<p><code>https://staging.diverza.com/api/v1/cancelar</code></p>

<hr>

<h2 id="encabezados">encabezados</h2>

<p>Todas las peticiones requieren los siguientes ecabezados:</p>

<h3 id="x-auth-token:">x-auth-token:</h3>

<p>Incluirá el token que nosotros te proporcionaremos para que te reconozcamos y podamos brindarte el servicio.
Para propósitos de pruebas, puedes usar el valor <strong>ABCD1234</strong> asignado al RFC Emisor AAA010101AAA.</p>

<h3 id="content-type:">Content-Type:</h3>

<p>Indicará el tipo de documento que deseas procesar:</p>

<p><code>Cancelación de CFDI</code></p>

<ul>
<li><strong><em>application/vnd.diverza.cancela.cfdi+xml; charset=UTF-8</em></strong></li>
</ul>

<p><code>Cancelación de constancia de retención</code></p>

<ul>
<li><strong><em>application/vnd.diverza.cancela.retencion+xml; charset=UTF-8</em></strong></li>
</ul>

<h3 id="content-md5:">Content-MD5:</h3>

<p>Contendrá el hash del archivo enviado en tu petición, expresado como una cadena de 32 caracteres.
Te recomendamos ampliamente implementar este valor, ya que te proporciona un mecanismo de certeza adicional.
Para propósito de pruebas, el valor de este atributo no será validado</p>

<hr>

<h2>cancelar<span class="diverza-dot">.</span></h2>

<p><br>
La siguiente es la estructura de la información contenida en el &quot;body&quot; de la petición, para el caso de uso de &quot;Terminal&quot;, se usará un archivo XML con éste contenido.</p>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;Cancelacion&gt;</span>
    <span class="nt">&lt;rfcEmisor&gt;</span>AAA010101AAA<span class="nt">&lt;/rfcEmisor&gt;</span>
    <span class="nt">&lt;Folios&gt;</span>
        <span class="nt">&lt;UUID&gt;</span>2fbac5d4-5814-42c0-b387-171d08f7c58a<span class="nt">&lt;/UUID&gt;</span>
    <span class="nt">&lt;/Folios&gt;</span>
<span class="nt">&lt;/Cancelacion&gt;</span>
</code></pre></div>
<hr>

<h2 id="servicio">Servicio</h2>

<p>Para el siguiente ejemplo de cancelación de un comprobante timbrado, usaremos:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"> Servidor de prueba: https://staging.diverza.com/
 Servicio: /api/v1/cancelar
 Metodo HTTP: POST
 Header HTTP: x-auth-token
 Header HTTP: Content-Type
 Header HTTP: Content-MD5
 Token de prueba: ABCD1234
 Content-Type: application/vnd.diverza.cancela.retencion+xml; charset=UTF-8
 Content-MD5: (Es el &quot;hash&quot; del archivo enviado en tu petición, expresado en una cadena de 32 caracteres.)
 UUID de prueba: 2fbac5d4-5814-42c0-b387-171d08f7c58a
</code></pre></div>
<p><strong>Si lo que deseas es cancelar un CFDI, sólo deberás cambiar el Content-Type por el siguiente:</strong></p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="s2">&quot;Content-Type: application/vnd.diverza.cancela.cfdi+xml; charset=UTF-8&quot;</span>
</code></pre></div>
<p><strong>Nota:</strong> Es importante que utilices el mismo token con el que timbraste el comprobante. Con él, comprobaremos que tu haces la petición y obtendremos los datos necesarios para procesar la cancelación con el SAT.</p>

<p><strong>Nota:</strong> El UUID es un atributo del complemento <em>TimbreFiscalDigital</em></p>

<hr>

<h3 id="petición-terminal">Petición terminal</h3>

<p>Usando la terminal o linea de comandos, ejecutar lo siguiente (ejemplo de cancelación de comprobante de retenciones y pagos):</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">curl -X POST https://staging.diverza.com/api/v1/cancelar --data @Cancela2.xml -H <span class="s2">&quot;Content-MD5: HASH/DOC&quot;</span> -H <span class="s2">&quot;Content-type: application/vnd.diverza.cancela.retencion+xml; charset=UTF-8&quot;</span> -H <span class="s2">&quot;x-auth-token: ABCD1234&quot;</span> -i
</code></pre></div>
<p><strong>Nota:</strong> La dirección del ejecutable <em>cURL</em> puede variar entre sistemas operativos y procesos de instalación.</p>

<p>Si revisamos el comando prodremos ver que la petición es dirigida a la URL del servicio de cancelación, utilizando el metodo POST; como headers, el token de seguridad, el Content-Type y el Content-MD5, el token que se utiliza para el ambiende de pruebas es <strong>ABCD1234</strong>.</p>

<h3 id="respuesta">Respuesta</h3>

<p>Una vez ejecutado el comando podremos observar en la respuesta:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">HTTP/1.1 200 OK
Server: nginx/1.0.15
Date: Wed, 28 Jan 2015 15:13:30 GMT
Content-Type: text/xml;charset=UTF-8
Connection: keep-alive
Content-Length: 92

HTTP/1.1 0 Proceso realizado con éxito
connection: keep-alive
server: Cowboy
date: Wed, 28 Jan 2015 15:13:30 GMT
content-length: 30
cache-control: max-age=0, private, must-revalidate

Proceso realizado con éxito
</code></pre></div>
<p><br>
El código de respuesta tambien es devuelto y debera ser <strong>200 OK</strong> y <strong>0 Proceso realizado con éxito</strong> cuando la petición sea exitosa, en caso contrario te invitamos a revisar la <a href="../cancelacion1/respuesta_cancelacion.html">Lista de Códigos de Respuesta para cancelación</a>, que contiene todos los posibles códigos de respuesta del servicio de timbrado y sus posibles soluciones.</p>

            </div>
          </div>
        </div>
      </div>
      <div id="sidebar-right" class="span3 sidebar">
    <div class="sidebar-padding">
        <div class=" ">
            <div class="module">

                <h3><a href="/timbre/indice.html">mapa del sitio<span class="diverza-dot">.</span></a></h3>
                <div class="clr"></div>
                <div class="module-content"></div>

                <h3>servicio<span class="diverza-dot">.</span></h3>
                <span class="h3-line"></span>
                <div class="clr"></div>

                <div class="module-content">
                    <ul class="menu">
                        <li class="item-178"><a href="/timbre/endpoints/">endpoints</a></li>
                        <li class="item-178"><a href="/timbre/refid.html">el refID</a></li>
                        <li class="item-178"><a href="/timbre/cfd/timbreWeb.html">cuenta web</a></li>
                        <li class="item-178"><a href="/timbre/cfd/repImpresa.html">representación impresa</a></li>
                    </ul>
                </div>

                <h3>recursos<span class="diverza-dot">.</span></h3>
                <span class="h3-line"></span>
                <div class="clr"></div>

                <div class="module-content">
                    <ul class="menu">
                        <li class="item-178"><a href="/timbre/cfd/">cfdi</a></li>
                        <li class="item-178"><a href="/timbre/cfd/comoGenerarCFDI.html">generar cfdi</a></li>
                        <li class="item-178"><a href="/timbre/recursos/">esquemas y ejemplos</a></li>
                        <li class="item-178"><a href="/timbre/lenguajes/">ejemplos de código</a></li>
                    </ul>
                </div>


                <h3>códigos de respuesta<span class="diverza-dot">.</span></h3>
                <span class="h3-line"></span>
                <div class="clr"></div>

                <div class="module-content">
                    <ul class="menu menu-lines">
                        <li class="item-178"><a href="/timbre/codigos/">emisión y timbrado</a></li>
                        <li class="item-178"><a href="/timbre/codigos/cod_cancelacion.html">cancelación</a></li>
                    </ul>
                </div>
 
                <h3>FAQ's<span class="diverza-dot">.</span></h3>
                <span class="h3-line"></span>
                <div class="clr"></div>
                <div class="module-content">
                    <ul class="menu">
                        <li class="item-178"><a href="/timbre/documentacionServicio/pregFrecuentes.html">preguntas frecuentes</a></li>
                        <li class="item-178"><a href="/timbre/documentacionServicio/errComunes.html">errores comunes</a></li>
                    </ul>               
                </div>
            </div>
            <div class="clr"></div>
        </div>
    </div>
</div>
    </div>
  </div>
</div>
  <style>
    .hero-unit { }
    #body { background: #fff url('/images/content-dev.png') no-repeat 50% 0 ; }
  </style>

  <div id="footer">
	<div class="container">
		<footer>

			<ul class="menu">
				<li class="item-123"><a href="http://www.diverza.com/privacidad">Aviso de privacidad</a></li><li class="item-124"><a href="http://www.diverza.com/terminos">Términos y condiciones</a></li><li class="item-125"><a href="http://www.diverza.com/integrate">Intégrate al equipo</a></li><li class="item-135"><a href="http://www.diverza.com/mi-cuenta">Mi cuenta</a></li></ul>

				<div class="custom">

					<div class="row-fluid">
						<br>
						<div class="span3"></div>

						<div class="span2" style="margin:0px"><a href="http://www.greatplacetowork.com.mx" title="GPTW" class="footer-logo-gptw" style="margin: -20px 0 0 auto;" target="_blank">GPTW</a></div>

						<div class="span2" style="margin:0 6px 0 20px;"><a href="http://www.sat.gob.mx/sitio_internet/asistencia_contribuyente/principiantes/comprobantes_fiscales/66_20006.html" title="SAT" class="footer-logo-sat" style="margin: -20px auto 0 auto;" target="_blank">SAT</a></div>

						<div class="span2" style="margin:0px"><a href="http://www.amexipac.org.mx" title="AMEXIPAC" class="footer-logo-amexipac" style="margin: -20px auto 0 0;" target="_blank">AMEXIPAC</a></div>

						<div class="span2"></div>

						<div class="clr"></div>

						<div style="font-size:10px; margin-top: 5px;">DIVERZA © Copyright.&nbsp;Los nombres y logos de Buzón Fiscal®, Conector Fiscal® y Timbre Fiscal® son marcas registradas de Diverza Información y Análisis, SAPI de CV. Otros nombres y logos son marcas registradas de sus respectivos propietarios. Todo el contenido de este sitio y los documentos para descarga son propiedad intelectual de Diverza Información y Análisis, SAPI de CV.<br> 

							<div class="clr"></div>
							<div style="font-size:12px;margin-top: 5px;text-align: center;">

								<script type="text/javascript">
									<!--
									var prefix = '&#109;a' + 'i&#108;' + '&#116;o';
									var path = 'hr' + 'ef' + '=';
									var addy64856 = 'c&#111;nt&#97;ct&#111;' + '&#64;';
									addy64856 = addy64856 + 'd&#105;v&#101;rz&#97;' + '&#46;' + 'c&#111;m';
									document.write('<a ' + path + '\'' + prefix + ':' + addy64856 + '\'>');
									document.write(addy64856);
									document.write('<\/a>');
									//-->\n </script>
									<span style="display: none;">This email address is being protected from spambots. You need JavaScript enabled to view it.
<script type="text/javascript">
	<!--
	document.write('</');
	document.write('span>');
 //-->
</script></span> &nbsp;&nbsp;&nbsp;| &nbsp;&nbsp;&nbsp;<a href="https://www.diverza.com/servicio-gratuito">acceso al servicio gratuito</a> &nbsp;&nbsp;&nbsp;| &nbsp;&nbsp;&nbsp; 01.800.070.4000</div></div>
</div></div>

</footer>
</div>
</div>
</body>
</html>