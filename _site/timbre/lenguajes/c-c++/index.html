<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <!-- syntax highlighting CSS -->
  <link rel="stylesheet" href="/css/syntax.css">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="/css/main.css">
  <!-- // <script src="http://syssgx.github.io/xml.js/js/xmllint.js"></script> -->
  <!-- // <script src="/scripts/bootstrap.min.js"></script> -->
  	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
	<script>window.jQuery || document.write('<script src="/scripts/jquery.min.js"><\/script>')</script>
	<script src="/scripts/bootstrap.min.js"></script>
<!--<script src="scripts/codemirror.js"></script>-->
    <!--<script src="scripts/searchcursor.js"></script>-->
    <!--<script src="scripts/match-highlighter.js"></script>-->
    <!--<script src="scripts/xml.js"></script>-->
	<!--<script src="scripts/prettify.js"></script>-->
	<!-- <script src="/scripts/xmllint.js"></script> -->
	<!-- // <script src="/scripts/script.js"></script> -->

  <link href="/favicon.ico" rel="shortcut icon" type="image/vnd.microsoft.icon" />

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-286386-31', 'auto');
    ga('send', 'pageview');
  </script>
  <title>C / C++</title>
</head>

<body class="page-content page-columns-2">
  <a name="top" id="top"></a>
<div id="header-bg">
  <div id="bg-top"><div id="bg-top-left"></div></div>
  <div id="bg-fix"></div>
</div>
<div class="container" id="header">
  <div class="navbar">
    <div class="navbar-inner">
      <div class="container">
        <a id="logo" class="brand icon-logo-off" href="http://diverza.com"></a>
        <div class="nav-collapse">

          <ul class="menu nav">
            <li class="item-101">
              <a href="">Portada</a>
            </li>
            <li class="item-102">
              <a href="http://www.diverza.com/historia" >historia</a>
            </li>
            <li class="item-103">
              <a href="http://blog.diverza.com" >blog</a>
            </li>
            <li class="item-104">
              <a href="http://desarrolladores.diverza.com" id="stamp-navitem-selected">ecosistema</a>
            </li>
            <li class="item-105">
              <a href="http://www.diverza.com/contacto" >contacto</a>
            </li>
            <li class="item-106">
              <a href="http://www.diverza.com/soporte" >soporte</a>
            </li>
            <li class="item-107">
            <a href="http://www.diverza.com/acceso" >acceso</a>
            </li>
            <li id="colors-bar">
              <div class="color-bar color-bar-blue"></div>
              <div class="color-bar color-bar-yellow"></div>
              <div class="color-bar color-bar-green"></div>
              <div class="color-bar color-bar-red"></div>
            </li></ul>
          </div>
          <div class="nav-social">
            <ul class="menu-social">
              <li class="item-131"><a class="rss" href="http://feeds.feedburner.com/blog-diverza">RSS</a></li><li class="item-130"><a class="googleplus" href="https://plus.google.com/u/0/100935627964150268592/posts">Google Plus</a></li><li class="item-129"><a class="youtube" href="http://www.youtube.com/user/DiverzaTv?feature=mhee">YouTube</a></li><li class="item-128"><a class="facebook" href="http://www.facebook.com/pages/Diverza/350358341644324">Facebook</a></li><li class="item-127"><a class="twitter" href="http://twitter.com/diverza">Twitter</a></li></ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="container" id="header-brand-dummy"></div>
    <div id="header-brand">
      <div class="navbar container">
        <div class="navbar-inner">
          <div class="container">
            <div class="row">

              <div class="span2 nav-welcome ">
                <a href="/"><span class="welcome">desarrolladores<span class="diverza-dot">.</span></span></a>
              </div>

              <div class="nav-collapse-brand" id="menu-sub">
                <ul class="menu nav">
                  <li class="item-102" id="stamp-menu-item">
                    <a href="/timbre/">timbre fiscal</a>
                  </li>
                  <li class="item-103" id="conector-menu-item">
                    <a href="/conector/">conector fiscal</a>
                  </li>
                  <li class="item-104" id="docs-menu-item">
                    <a href="/documentos/">documentos</a>
                  </li>
                  <li class="item-105">
                    <a href="https://groups.google.com/forum/#!forum/diverza" target="_blank">grupos</a>
                  </li>
                  <li class="item-106">
                    <a href="https://github.com/diverza/desarrolladores" target="_blank">github</a>
                  </li>
                </ul>
              </div>
              <div class="nav-account">
                <div class="module">
                  <div class="custom">01.800.070.4000</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

  <style>
  #stamp-menu-item { color: #fff !important;
    background: #ddd;
    -webkit-box-shadow: inset 2px 2px 2px rgba(0, 0, 0, 0.25);
    -moz-box-shadow: inset 2px 2px 2px rgba(0, 0, 0, 0.25);
    -o-box-shadow: inset 2px 2px 2px rgba(0, 0, 0, 0.25);
    -ms-box-shadow: inset 2px 2px 2px rgba(0, 0, 0, 0.25);
    box-shadow: inset 2px 2px 2px rgba(0, 0, 0, 0.25);
    -webkit-border-radius: 20px;
    -moz-border-radius: 20px;
    -o-border-radius: 20px;
    -ms-border-radius: 20px;
    border-radius: 20px;
    text-shadow: 1px 1px rgba(0, 0, 0, 0.20);
    height: 35px;
    margin-top: 2px;
  }
</style>

<div id="body">
  <div class="container">
    <div id="main" class="row">
      <div id="content" class="span12">
        <div id="system-message-container">
        </div>
        <div id="component">
          <div class="item-pagepage-history">
            <div class="clr"></div>
            <div class="article-content-text">
              <h1>C / C++<span class="diverza-dot">.</span></h1>
              <span class="h1-line"></span>
              <div class="clr">&nbsp;</div>
              <p>La siguiente guía comprende la conexión con el servicio de timbrado utilizando C / C++, en el caso de Windows es necesario tener instalado Visual Studio 2005 o superior y para Unix/Linux/OSX gcc y cURL.</p>

<p>El código de esta guía se encuentra disponible para su descarga en el <a href="https://github.com/diverza/desarrolladores/tree/master/Timbre/C-C++">repositorio de ejemplos para Timbre Fiscal.</a></p>

<hr>

<h2 id="generar-timbre">Generar Timbre</h2>

<p>Para generar un timbre utilizando el servidor de pruebas es necesario tener los siguientes datos del servidor a la mano:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"> Servidor de prueba: https://staging.diverza.com/stamp
 Token de prueba: ABCD1234
 Metodo HTTP: POST
 Header HTTP: x-auth-token
</code></pre></div>
<p>Así como también el CFDI de prueba que usaremos en este ejercicio:</p>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;cfdi:Comprobante</span> 
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.sat.gob.mx/cfd/3 http://www.sat.gob.mx/sitio_internet/cfd/3/cfdv32.xsd&quot;</span> 
    <span class="na">xmlns:cfdi=</span><span class="s">&quot;http://www.sat.gob.mx/cfd/3&quot;</span> 
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> 
    <span class="na">xmlns:xs=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema&quot;</span>
    <span class="na">LugarExpedicion=</span><span class="s">&quot;D.F.,MEXICO&quot;</span> 
    <span class="na">NumCtaPago=</span><span class="s">&quot;DESCONOCIDO&quot;</span> 
    <span class="na">formaDePago=</span><span class="s">&quot;PAGO EN UNA SOLA EXHIBICION&quot;</span> 
    <span class="na">metodoDePago=</span><span class="s">&quot;TRANSFERENCIA ELECTRONICA&quot;</span>
    <span class="na">subTotal=</span><span class="s">&quot;1000.00&quot;</span> 
    <span class="na">total=</span><span class="s">&quot;1160.00&quot;</span> 
    <span class="na">fecha=</span><span class="s">&quot;2013-12-02T22:18:24&quot;</span> 
    <span class="na">certificado=</span><span class="s">&quot;MIIEdDCCA1ygAwIBAgIUMjAwMDEwMDAwMDAxMDAwMDU4NjcwDQYJKoZIhvcNAQEFBQAwggFvMRgwFgYDVQQDDA9BLkMuIGRlIHBydWViYXMxLzAtBgNVBAoMJlNlcnZpY2lvIGRlIEFkbWluaXN0cmFjacOzbiBUcmlidXRhcmlhMTgwNgYDVQQLDC9BZG1pbmlzdHJhY2nDs24gZGUgU2VndXJpZGFkIGRlIGxhIEluZm9ybWFjacOzbjEpMCcGCSqGSIb3DQEJARYaYXNpc25ldEBwcnVlYmFzLnNhdC5nb2IubXgxJjAkBgNVBAkMHUF2LiBIaWRhbGdvIDc3LCBDb2wuIEd1ZXJyZXJvMQ4wDAYDVQQRDAUwNjMwMDELMAkGA1UEBhMCTVgxGTAXBgNVBAgMEERpc3RyaXRvIEZlZGVyYWwxEjAQBgNVBAcMCUNveW9hY8OhbjEVMBMGA1UELRMMU0FUOTcwNzAxTk4zMTIwMAYJKoZIhvcNAQkCDCNSZXNwb25zYWJsZTogSMOpY3RvciBPcm5lbGFzIEFyY2lnYTAeFw0xMjA3MjcxNzAyMDBaFw0xNjA3MjcxNzAyMDBaMIHbMSkwJwYDVQQDEyBBQ0NFTSBTRVJWSUNJT1MgRU1QUkVTQVJJQUxFUyBTQzEpMCcGA1UEKRMgQUNDRU0gU0VSVklDSU9TIEVNUFJFU0FSSUFMRVMgU0MxKTAnBgNVBAoTIEFDQ0VNIFNFUlZJQ0lPUyBFTVBSRVNBUklBTEVTIFNDMSUwIwYDVQQtExxBQUEwMTAxMDFBQUEgLyBIRUdUNzYxMDAzNFMyMR4wHAYDVQQFExUgLyBIRUdUNzYxMDAzTURGUk5OMDkxETAPBgNVBAsTCFVuaWRhZCAxMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC2TTQSPONBOVxpXv9wLYo8jezBrb34i/tLx8jGdtyy27BcesOav2c1NS/Gdv10u9SkWtwdy34uRAVe7H0a3VMRLHAkvp2qMCHaZc4T8k47Jtb9wrOEh/XFS8LgT4y5OQYo6civfXXdlvxWU/gdM/e6I2lg6FGorP8H4GPAJ/qCNwIDAQABox0wGzAMBgNVHRMBAf8EAjAAMAsGA1UdDwQEAwIGwDANBgkqhkiG9w0BAQUFAAOCAQEATxMecTpMbdhSHo6KVUg4QVF4Op2IBhiMaOrtrXBdJgzGotUFcJgdBCMjtTZXSlq1S4DG1jr8p4NzQlzxsdTxaB8nSKJ4KEMgIT7E62xRUj15jI49qFz7f2uMttZLNThipunsN/NF1XtvESMTDwQFvas/Ugig6qwEfSZc0MDxMpKLEkEePmQwtZD+zXFSMVa6hmOu4M+FzGiRXbj4YJXn9Myjd8xbL/c+9UIcrYoZskxDvMxc6/6M3rNNDY3OFhBK+V/sPMzWWGt8S1yjmtPfXgFs1t65AZ2hcTwTAuHrKwDatJ1ZPfa482ZBROAAX1waz7WwXp0gso7sDCm2/yUVww==&quot;</span> 
    <span class="na">noCertificado=</span><span class="s">&quot;20001000000100005867&quot;</span> 
    <span class="na">sello=</span><span class="s">&quot;qTzEwNUDvk/WpeFstpf/FLNmiHMxiL8pDTXGNb+DCFO0Z7SXMZJCim3JAlBw8Astvr0/jiVfo3WdWbaX88cC1l1+iipOLdedbFNHZUmsW86nC1YQHWw0S6mEiGH0ZxGa5KOl/1mrvPlDweeCiyYavNQeEuO1r0/ELobMi07w6ps=&quot;</span> 
    <span class="na">tipoDeComprobante=</span><span class="s">&quot;ingreso&quot;</span>
    <span class="na">version=</span><span class="s">&quot;3.2&quot;</span> <span class="nt">&gt;</span>
    <span class="nt">&lt;cfdi:Emisor</span> <span class="na">nombre=</span><span class="s">&quot;EMPRESA DEMO&quot;</span> <span class="na">rfc=</span><span class="s">&quot;AAA010101AAA&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;cfdi:DomicilioFiscal</span> <span class="na">codigoPostal=</span><span class="s">&quot;34343&quot;</span> <span class="na">pais=</span><span class="s">&quot;MEXICO&quot;</span> <span class="na">estado=</span><span class="s">&quot;DISTRITO FEDERAL&quot;</span> <span class="na">municipio=</span><span class="s">&quot;BENITO JUAREZ&quot;</span> <span class="na">calle=</span><span class="s">&quot;REFORMA&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;cfdi:RegimenFiscal</span> <span class="na">Regimen=</span><span class="s">&quot;PERSONA FISCA&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/cfdi:Emisor&gt;</span>
    <span class="nt">&lt;cfdi:Receptor</span> <span class="na">nombre=</span><span class="s">&quot;PUBLICO EN GENERAL&quot;</span> <span class="na">rfc=</span><span class="s">&quot;XAXX010101000&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;cfdi:Domicilio</span> <span class="na">pais=</span><span class="s">&quot;MEXICO&quot;</span> <span class="na">calle=</span><span class="s">&quot;INSURGENTES&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/cfdi:Receptor&gt;</span>
    <span class="nt">&lt;cfdi:Conceptos&gt;</span>
        <span class="nt">&lt;cfdi:Concepto</span> <span class="na">importe=</span><span class="s">&quot;1000.00&quot;</span> <span class="na">valorUnitario=</span><span class="s">&quot;1000.00&quot;</span> <span class="na">descripcion=</span><span class="s">&quot;PZA&quot;</span> <span class="na">unidad=</span><span class="s">&quot;CANT&quot;</span> <span class="na">cantidad=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/cfdi:Conceptos&gt;</span>
    <span class="nt">&lt;cfdi:Impuestos&gt;</span>
        <span class="nt">&lt;cfdi:Traslados&gt;</span>
            <span class="nt">&lt;cfdi:Traslado</span> <span class="na">importe=</span><span class="s">&quot;160.00&quot;</span> <span class="na">tasa=</span><span class="s">&quot;160.00&quot;</span> <span class="na">impuesto=</span><span class="s">&quot;IVA&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/cfdi:Traslados&gt;</span>
    <span class="nt">&lt;/cfdi:Impuestos&gt;</span>
    <span class="nt">&lt;cfdi:Addenda/&gt;</span>
<span class="nt">&lt;/cfdi:Comprobante&gt;</span>
</code></pre></div>
<p><strong>Nota:</strong> Para conocer más acerca de como construir un CFDI, te recomendamos visitar la siguiente guía: <a href="/timbre/cfd/">Como generar un CFDI.</a></p>

<hr>

<h3 id="inicio">Inicio</h3>

<p>Primeramente necesitamos crear una nueva carpeta con el nombre <strong>timbrar</strong> y crear dos archivos:</p>

<ul>
<li><strong>cfdi.xml</strong> - Deberemos guardar el contenido del CFDI a timbrar en el:</li>
</ul>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;cfdi:Comprobante</span> 
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.sat.gob.mx/cfd/3 http://www.sat.gob.mx/sitio_internet/cfd/3/cfdv32.xsd&quot;</span> 
    <span class="na">xmlns:cfdi=</span><span class="s">&quot;http://www.sat.gob.mx/cfd/3&quot;</span> 
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> 
    <span class="na">xmlns:xs=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema&quot;</span>
    <span class="na">LugarExpedicion=</span><span class="s">&quot;D.F.,MEXICO&quot;</span> 
    <span class="na">NumCtaPago=</span><span class="s">&quot;DESCONOCIDO&quot;</span> 
    <span class="na">formaDePago=</span><span class="s">&quot;PAGO EN UNA SOLA EXHIBICION&quot;</span> 
    <span class="na">metodoDePago=</span><span class="s">&quot;TRANSFERENCIA ELECTRONICA&quot;</span>
    <span class="na">subTotal=</span><span class="s">&quot;1000.00&quot;</span> 
    <span class="na">total=</span><span class="s">&quot;1160.00&quot;</span> 
    <span class="na">fecha=</span><span class="s">&quot;2013-12-02T22:18:24&quot;</span> 
    <span class="na">certificado=</span><span class="s">&quot;MIIEdDCCA1ygAwIBAgIUMjAwMDEwMDAwMDAxMDAwMDU4NjcwDQYJKoZIhvcNAQEFBQAwggFvMRgwFgYDVQQDDA9BLkMuIGRlIHBydWViYXMxLzAtBgNVBAoMJlNlcnZpY2lvIGRlIEFkbWluaXN0cmFjacOzbiBUcmlidXRhcmlhMTgwNgYDVQQLDC9BZG1pbmlzdHJhY2nDs24gZGUgU2VndXJpZGFkIGRlIGxhIEluZm9ybWFjacOzbjEpMCcGCSqGSIb3DQEJARYaYXNpc25ldEBwcnVlYmFzLnNhdC5nb2IubXgxJjAkBgNVBAkMHUF2LiBIaWRhbGdvIDc3LCBDb2wuIEd1ZXJyZXJvMQ4wDAYDVQQRDAUwNjMwMDELMAkGA1UEBhMCTVgxGTAXBgNVBAgMEERpc3RyaXRvIEZlZGVyYWwxEjAQBgNVBAcMCUNveW9hY8OhbjEVMBMGA1UELRMMU0FUOTcwNzAxTk4zMTIwMAYJKoZIhvcNAQkCDCNSZXNwb25zYWJsZTogSMOpY3RvciBPcm5lbGFzIEFyY2lnYTAeFw0xMjA3MjcxNzAyMDBaFw0xNjA3MjcxNzAyMDBaMIHbMSkwJwYDVQQDEyBBQ0NFTSBTRVJWSUNJT1MgRU1QUkVTQVJJQUxFUyBTQzEpMCcGA1UEKRMgQUNDRU0gU0VSVklDSU9TIEVNUFJFU0FSSUFMRVMgU0MxKTAnBgNVBAoTIEFDQ0VNIFNFUlZJQ0lPUyBFTVBSRVNBUklBTEVTIFNDMSUwIwYDVQQtExxBQUEwMTAxMDFBQUEgLyBIRUdUNzYxMDAzNFMyMR4wHAYDVQQFExUgLyBIRUdUNzYxMDAzTURGUk5OMDkxETAPBgNVBAsTCFVuaWRhZCAxMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC2TTQSPONBOVxpXv9wLYo8jezBrb34i/tLx8jGdtyy27BcesOav2c1NS/Gdv10u9SkWtwdy34uRAVe7H0a3VMRLHAkvp2qMCHaZc4T8k47Jtb9wrOEh/XFS8LgT4y5OQYo6civfXXdlvxWU/gdM/e6I2lg6FGorP8H4GPAJ/qCNwIDAQABox0wGzAMBgNVHRMBAf8EAjAAMAsGA1UdDwQEAwIGwDANBgkqhkiG9w0BAQUFAAOCAQEATxMecTpMbdhSHo6KVUg4QVF4Op2IBhiMaOrtrXBdJgzGotUFcJgdBCMjtTZXSlq1S4DG1jr8p4NzQlzxsdTxaB8nSKJ4KEMgIT7E62xRUj15jI49qFz7f2uMttZLNThipunsN/NF1XtvESMTDwQFvas/Ugig6qwEfSZc0MDxMpKLEkEePmQwtZD+zXFSMVa6hmOu4M+FzGiRXbj4YJXn9Myjd8xbL/c+9UIcrYoZskxDvMxc6/6M3rNNDY3OFhBK+V/sPMzWWGt8S1yjmtPfXgFs1t65AZ2hcTwTAuHrKwDatJ1ZPfa482ZBROAAX1waz7WwXp0gso7sDCm2/yUVww==&quot;</span> 
    <span class="na">noCertificado=</span><span class="s">&quot;20001000000100005867&quot;</span> 
    <span class="na">sello=</span><span class="s">&quot;qTzEwNUDvk/WpeFstpf/FLNmiHMxiL8pDTXGNb+DCFO0Z7SXMZJCim3JAlBw8Astvr0/jiVfo3WdWbaX88cC1l1+iipOLdedbFNHZUmsW86nC1YQHWw0S6mEiGH0ZxGa5KOl/1mrvPlDweeCiyYavNQeEuO1r0/ELobMi07w6ps=&quot;</span> 
    <span class="na">tipoDeComprobante=</span><span class="s">&quot;ingreso&quot;</span>
    <span class="na">version=</span><span class="s">&quot;3.2&quot;</span> <span class="nt">&gt;</span>
    <span class="nt">&lt;cfdi:Emisor</span> <span class="na">nombre=</span><span class="s">&quot;EMPRESA DEMO&quot;</span> <span class="na">rfc=</span><span class="s">&quot;AAA010101AAA&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;cfdi:DomicilioFiscal</span> <span class="na">codigoPostal=</span><span class="s">&quot;34343&quot;</span> <span class="na">pais=</span><span class="s">&quot;MEXICO&quot;</span> <span class="na">estado=</span><span class="s">&quot;DISTRITO FEDERAL&quot;</span> <span class="na">municipio=</span><span class="s">&quot;BENITO JUAREZ&quot;</span> <span class="na">calle=</span><span class="s">&quot;REFORMA&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;cfdi:RegimenFiscal</span> <span class="na">Regimen=</span><span class="s">&quot;PERSONA FISCA&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/cfdi:Emisor&gt;</span>
    <span class="nt">&lt;cfdi:Receptor</span> <span class="na">nombre=</span><span class="s">&quot;PUBLICO EN GENERAL&quot;</span> <span class="na">rfc=</span><span class="s">&quot;XAXX010101000&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;cfdi:Domicilio</span> <span class="na">pais=</span><span class="s">&quot;MEXICO&quot;</span> <span class="na">calle=</span><span class="s">&quot;INSURGENTES&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/cfdi:Receptor&gt;</span>
    <span class="nt">&lt;cfdi:Conceptos&gt;</span>
        <span class="nt">&lt;cfdi:Concepto</span> <span class="na">importe=</span><span class="s">&quot;1000.00&quot;</span> <span class="na">valorUnitario=</span><span class="s">&quot;1000.00&quot;</span> <span class="na">descripcion=</span><span class="s">&quot;PZA&quot;</span> <span class="na">unidad=</span><span class="s">&quot;CANT&quot;</span> <span class="na">cantidad=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/cfdi:Conceptos&gt;</span>
    <span class="nt">&lt;cfdi:Impuestos&gt;</span>
        <span class="nt">&lt;cfdi:Traslados&gt;</span>
            <span class="nt">&lt;cfdi:Traslado</span> <span class="na">importe=</span><span class="s">&quot;160.00&quot;</span> <span class="na">tasa=</span><span class="s">&quot;160.00&quot;</span> <span class="na">impuesto=</span><span class="s">&quot;IVA&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/cfdi:Traslados&gt;</span>
    <span class="nt">&lt;/cfdi:Impuestos&gt;</span>
    <span class="nt">&lt;cfdi:Addenda/&gt;</span>
<span class="nt">&lt;/cfdi:Comprobante&gt;</span>
</code></pre></div>
<ul>
<li><strong>timbrar.c</strong> - El archivo de codigo fuente que estaremos modificando en este ejercicio.</li>
</ul>

<p><strong>Unicamente para Windows:</strong> Se debera descargar el archivo comprimido <a href="">includes.zip</a> y descomprimirlo dentro de la carpeta timbrar </p>

<p>El siguiente paso es incluir las librerias que utilizaremos en el proyecto:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1">#include &lt;curl/curl.h&gt;</span>
<span class="c1">#include &lt;string.h&gt;</span>
<span class="c1">#include &lt;stdlib.h&gt;</span>
</code></pre></div>
<p>Ahora es necesario agregar algunas funciones de soporte para el resto de nuestro codigo:</p>

<p><strong>Windows</strong></p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="sr">//</span> <span class="no">Estructura</span> <span class="n">necesaria</span> <span class="n">para</span> <span class="n">la</span> <span class="n">escritura</span> <span class="n">del</span> <span class="n">cuerpo</span> <span class="n">de</span> <span class="n">la</span> <span class="n">petici</span><span class="err">ó</span><span class="n">n</span>
<span class="n">struct</span> <span class="no">WriteStructure</span> 
<span class="p">{</span>
  <span class="n">const</span> <span class="n">char</span> <span class="o">*</span><span class="n">readptr</span><span class="p">;</span>
  <span class="n">long</span> <span class="n">sizeleft</span><span class="p">;</span>
<span class="p">};</span>

<span class="sr">//</span> <span class="no">Funcion</span> <span class="n">de</span> <span class="n">lectura</span> <span class="n">para</span> <span class="n">la</span> <span class="n">respuesta</span> <span class="n">del</span> <span class="n">servicio</span> <span class="n">de</span> <span class="n">timbrado</span>
<span class="n">static</span> <span class="n">void</span> <span class="n">write_callback_function</span><span class="p">(</span><span class="n">void</span> <span class="o">*</span><span class="n">ptr</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">size</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">nmemb</span><span class="p">,</span> <span class="n">void</span> <span class="o">*</span><span class="n">userp</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">char</span> <span class="o">**</span><span class="n">response_ptr</span> <span class="o">=</span>  <span class="p">(</span><span class="n">char</span><span class="o">**</span><span class="p">)</span><span class="n">userp</span><span class="p">;</span>
  <span class="o">*</span><span class="n">response_ptr</span> <span class="o">=</span> <span class="n">strdup</span><span class="p">(</span><span class="n">ptr</span><span class="p">);</span>
<span class="p">}</span>

<span class="sr">//</span> <span class="no">Funcion</span> <span class="n">de</span> <span class="n">escritura</span> <span class="n">para</span> <span class="n">el</span> <span class="n">cuerpo</span> <span class="n">de</span> <span class="n">la</span> <span class="n">petici</span><span class="err">ó</span><span class="n">n</span> <span class="no">HTTP</span>
<span class="n">static</span> <span class="n">size_t</span> <span class="n">read_callback_function</span><span class="p">(</span><span class="n">void</span> <span class="o">*</span><span class="n">ptr</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">size</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">nmemb</span><span class="p">,</span> <span class="n">void</span> <span class="o">*</span><span class="n">userp</span><span class="p">)</span>
<span class="p">{</span> 
  <span class="n">struct</span> <span class="no">WriteStructure</span> <span class="o">*</span><span class="n">writeStructure</span> <span class="o">=</span> <span class="p">(</span><span class="n">struct</span> <span class="no">WriteStructure</span> <span class="o">*</span><span class="p">)</span><span class="n">userp</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">size</span><span class="o">*</span><span class="n">nmemb</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span>
  <span class="p">{</span>
   <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">writeStructure</span><span class="o">-&gt;</span><span class="n">sizeleft</span><span class="p">)</span> 
  <span class="p">{</span>
    <span class="o">*</span><span class="p">(</span><span class="n">char</span> <span class="o">*</span><span class="p">)</span><span class="n">ptr</span> <span class="o">=</span> <span class="n">writeStructure</span><span class="o">-&gt;</span><span class="n">readptr</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span> 
    <span class="n">writeStructure</span><span class="o">-&gt;</span><span class="n">readptr</span><span class="o">++</span><span class="p">;</span>                 
    <span class="n">writeStructure</span><span class="o">-&gt;</span><span class="n">sizeleft</span><span class="o">--</span><span class="p">;</span>               
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>                        
  <span class="p">}</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>                          
<span class="p">}</span>

<span class="sr">//</span> <span class="no">Function</span> <span class="n">de</span> <span class="n">lectura</span> <span class="n">para</span> <span class="n">el</span> <span class="n">archivo</span> <span class="no">XML</span> <span class="n">que</span> <span class="n">contiene</span> <span class="n">el</span> <span class="no">CFDI</span> <span class="n">a</span> <span class="n">timbrar</span>
<span class="n">static</span> <span class="n">char</span><span class="o">*</span> <span class="n">read_cfd_file</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">char</span> <span class="o">*</span><span class="n">cfd</span><span class="p">;</span>
  <span class="n">long</span> <span class="n">cfd_file_size</span><span class="p">;</span>

  <span class="no">FILE</span> <span class="o">*</span><span class="n">cfd_file</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s2">&quot;cfdi.xml&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">);</span>

  <span class="n">fseek</span><span class="p">(</span><span class="n">cfd_file</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="no">SEEK_END</span><span class="p">);</span>
  <span class="n">cfd_file_size</span> <span class="o">=</span> <span class="n">ftell</span><span class="p">(</span><span class="n">cfd_file</span><span class="p">);</span>
  <span class="n">rewind</span><span class="p">(</span><span class="n">cfd_file</span><span class="p">);</span>
  <span class="n">cfd</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">cfd_file_size</span> <span class="o">*</span> <span class="p">(</span><span class="n">sizeof</span><span class="p">(</span><span class="n">char</span><span class="p">)));</span>
  <span class="n">fread</span><span class="p">(</span><span class="n">cfd</span><span class="p">,</span> <span class="n">sizeof</span><span class="p">(</span><span class="n">char</span><span class="p">),</span> <span class="n">cfd_file_size</span><span class="p">,</span> <span class="n">cfd_file</span><span class="p">);</span>
  <span class="n">fclose</span><span class="p">(</span><span class="n">cfd_file</span><span class="p">);</span>

  <span class="k">return</span> <span class="n">cfd</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Unix/Linux/OSX</strong></p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="sr">//</span> <span class="no">Estructura</span> <span class="n">necesaria</span> <span class="n">para</span> <span class="n">la</span> <span class="n">escritura</span> <span class="n">del</span> <span class="n">cuerpo</span> <span class="n">de</span> <span class="n">la</span> <span class="n">petici</span><span class="err">ó</span><span class="n">n</span>
<span class="n">struct</span> <span class="no">WriteStructure</span> 
<span class="p">{</span>
  <span class="n">const</span> <span class="n">char</span> <span class="o">*</span><span class="n">readptr</span><span class="p">;</span>
  <span class="n">long</span> <span class="n">sizeleft</span><span class="p">;</span>
<span class="p">};</span>

<span class="sr">//</span> <span class="no">Funcion</span> <span class="n">de</span> <span class="n">lectura</span> <span class="n">para</span> <span class="n">la</span> <span class="n">respuesta</span> <span class="n">del</span> <span class="n">servicio</span> <span class="n">de</span> <span class="n">timbrado</span>
<span class="n">static</span> <span class="n">void</span> <span class="n">write_callback_function</span><span class="p">(</span><span class="n">void</span> <span class="o">*</span><span class="n">ptr</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">size</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">nmemb</span><span class="p">,</span> <span class="n">void</span> <span class="o">*</span><span class="n">userp</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">char</span> <span class="o">**</span><span class="n">response_ptr</span> <span class="o">=</span>  <span class="p">(</span><span class="n">char</span><span class="o">**</span><span class="p">)</span><span class="n">userp</span><span class="p">;</span>
  <span class="o">*</span><span class="n">response_ptr</span> <span class="o">=</span> <span class="n">strndup</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span> <span class="p">(</span><span class="n">size_t</span><span class="p">)(</span><span class="n">size</span> <span class="o">*</span><span class="n">nmemb</span><span class="p">));</span>
<span class="p">}</span>

<span class="sr">//</span> <span class="no">Funcion</span> <span class="n">de</span> <span class="n">escritura</span> <span class="n">para</span> <span class="n">el</span> <span class="n">cuerpo</span> <span class="n">de</span> <span class="n">la</span> <span class="n">petici</span><span class="err">ó</span><span class="n">n</span> <span class="no">HTTP</span>
<span class="n">static</span> <span class="n">size_t</span> <span class="n">read_callback_function</span><span class="p">(</span><span class="n">void</span> <span class="o">*</span><span class="n">ptr</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">size</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">nmemb</span><span class="p">,</span> <span class="n">void</span> <span class="o">*</span><span class="n">userp</span><span class="p">)</span>
<span class="p">{</span> 
  <span class="n">struct</span> <span class="no">WriteStructure</span> <span class="o">*</span><span class="n">writeStructure</span> <span class="o">=</span> <span class="p">(</span><span class="n">struct</span> <span class="no">WriteStructure</span> <span class="o">*</span><span class="p">)</span><span class="n">userp</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">size</span><span class="o">*</span><span class="n">nmemb</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span>
  <span class="p">{</span>
   <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">writeStructure</span><span class="o">-&gt;</span><span class="n">sizeleft</span><span class="p">)</span> 
  <span class="p">{</span>
    <span class="o">*</span><span class="p">(</span><span class="n">char</span> <span class="o">*</span><span class="p">)</span><span class="n">ptr</span> <span class="o">=</span> <span class="n">writeStructure</span><span class="o">-&gt;</span><span class="n">readptr</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span> 
    <span class="n">writeStructure</span><span class="o">-&gt;</span><span class="n">readptr</span><span class="o">++</span><span class="p">;</span>                 
    <span class="n">writeStructure</span><span class="o">-&gt;</span><span class="n">sizeleft</span><span class="o">--</span><span class="p">;</span>               
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>                        
  <span class="p">}</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>                          
<span class="p">}</span>

<span class="sr">//</span> <span class="no">Function</span> <span class="n">de</span> <span class="n">lectura</span> <span class="n">para</span> <span class="n">el</span> <span class="n">archivo</span> <span class="no">XML</span> <span class="n">que</span> <span class="n">contiene</span> <span class="n">el</span> <span class="no">CFDI</span> <span class="n">a</span> <span class="n">timbrar</span>
<span class="n">static</span> <span class="n">char</span><span class="o">*</span> <span class="n">read_cfd_file</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">char</span> <span class="o">*</span><span class="n">cfd</span><span class="p">;</span>
  <span class="n">long</span> <span class="n">cfd_file_size</span><span class="p">;</span>

  <span class="no">FILE</span> <span class="o">*</span><span class="n">cfd_file</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s2">&quot;cfd.xml&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">);</span>

  <span class="n">fseek</span><span class="p">(</span><span class="n">cfd_file</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="no">SEEK_END</span><span class="p">);</span>
  <span class="n">cfd_file_size</span> <span class="o">=</span> <span class="n">ftell</span><span class="p">(</span><span class="n">cfd_file</span><span class="p">);</span>
  <span class="n">rewind</span><span class="p">(</span><span class="n">cfd_file</span><span class="p">);</span>
  <span class="n">cfd</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">cfd_file_size</span> <span class="o">*</span> <span class="p">(</span><span class="n">sizeof</span><span class="p">(</span><span class="n">char</span><span class="p">)));</span>
  <span class="n">fread</span><span class="p">(</span><span class="n">cfd</span><span class="p">,</span> <span class="n">sizeof</span><span class="p">(</span><span class="n">char</span><span class="p">),</span> <span class="n">cfd_file_size</span><span class="p">,</span> <span class="n">cfd_file</span><span class="p">);</span>
  <span class="n">fclose</span><span class="p">(</span><span class="n">cfd_file</span><span class="p">);</span>

  <span class="k">return</span> <span class="n">cfd</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Nota:</strong> Por favor seleccione la version del sistema operativo que le corresponde para las funciones de ayuda.</p>

<hr>

<h3 id="petición-http">Petición HTTP</h3>

<p>Es momento de crear nuestra funcion main y declarar las variables que utilizaremos en ella:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">int</span> <span class="n">main</span><span class="p">(</span><span class="n">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">char</span> <span class="o">*</span><span class="n">cfd</span><span class="p">;</span>
  <span class="n">char</span> <span class="o">*</span><span class="n">stamp</span><span class="p">;</span>
  <span class="n">long</span> <span class="n">response_code</span><span class="p">;</span>
  <span class="no">CURL</span> <span class="o">*</span><span class="n">curl</span><span class="p">;</span>
  <span class="no">CURLcode</span> <span class="n">result</span><span class="p">;</span>
  <span class="n">struct</span> <span class="n">curl_slist</span> <span class="o">*</span><span class="n">headers</span> <span class="o">=</span> <span class="no">NULL</span><span class="p">;</span>
  <span class="n">struct</span> <span class="no">WriteStructure</span> <span class="n">writeStructure</span><span class="p">;</span>
</code></pre></div>
<p>Ahora deberemos inicializar las librerias de CURL:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">result</span> <span class="o">=</span> <span class="n">curl_global_init</span><span class="p">(</span><span class="no">CURL_GLOBAL_DEFAULT</span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="n">result</span> <span class="o">!=</span> <span class="no">CURLE_OK</span><span class="p">)</span> 
<span class="p">{</span>
  <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s2">&quot;Error en curl_global_init(): %s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">curl_easy_strerror</span><span class="p">(</span><span class="n">result</span><span class="p">));</span>
  <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>El siguiente paso es inicializar una petición de cURL:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">curl</span> <span class="o">=</span> <span class="n">curl_easy_init</span><span class="p">();</span>
<span class="k">if</span><span class="p">(</span><span class="n">curl</span><span class="p">)</span> 
<span class="p">{</span>
</code></pre></div>
<p>Incluimos el CFDI leyendo el archivo cfdi.xml y lo guardamos en una estructura que utilizaremos posteriormente:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">cfd</span> <span class="o">=</span> <span class="n">read_cfd_file</span><span class="p">();</span>

<span class="n">writeStructure</span><span class="o">.</span><span class="n">readptr</span> <span class="o">=</span> <span class="n">cfd</span><span class="p">;</span>
<span class="n">writeStructure</span><span class="o">.</span><span class="n">sizeleft</span> <span class="o">=</span> <span class="p">(</span><span class="n">long</span><span class="p">)</span><span class="n">strlen</span><span class="p">(</span><span class="n">cfd</span><span class="p">);</span>
</code></pre></div>
<p>Agregamos a la petición de cURL la URL del servicio de timbrado:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">curl_easy_setopt</span><span class="p">(</span><span class="n">curl</span><span class="p">,</span> <span class="no">CURLOPT_URL</span><span class="p">,</span> <span class="s2">&quot;https://staging.diverza.com/stamp&quot;</span><span class="p">);</span>
</code></pre></div>
<p>Es necesario que la petición use el metodo HTTP post:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">curl_easy_setopt</span><span class="p">(</span><span class="n">curl</span><span class="p">,</span> <span class="no">CURLOPT_POST</span><span class="p">,</span> <span class="mi">1</span><span class="n">L</span><span class="p">);</span>
</code></pre></div>
<p>Por motivos de seguridad es necesario que agreguemos un token de seguridad a la petición, en esta guía utilizaremos el de prueba <strong>ABCD1234</strong> y este deberá ser cambiado cuando deseemos pasar el código a producción:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">headers</span> <span class="o">=</span> <span class="n">curl_slist_append</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="s2">&quot;x-auth-token: ABCD1234&quot;</span><span class="p">);</span>
<span class="n">curl_easy_setopt</span><span class="p">(</span><span class="n">curl</span><span class="p">,</span> <span class="no">CURLOPT_HTTPHEADER</span><span class="p">,</span><span class="n">headers</span><span class="p">);</span>
</code></pre></div>
<p>Es necesario decirle a la petición de cURL que utilizaremos dos funciones una para la escritura del mensaje en el servicio de timbrado y la otra para la escritura:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">curl_easy_setopt</span><span class="p">(</span><span class="n">curl</span><span class="p">,</span> <span class="no">CURLOPT_READFUNCTION</span><span class="p">,</span> <span class="n">read_callback_function</span><span class="p">);</span>
<span class="n">curl_easy_setopt</span><span class="p">(</span><span class="n">curl</span><span class="p">,</span> <span class="no">CURLOPT_READDATA</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">writeStructure</span><span class="p">);</span>
<span class="n">curl_easy_setopt</span><span class="p">(</span><span class="n">curl</span><span class="p">,</span> <span class="no">CURLOPT_POSTFIELDSIZE</span><span class="p">,</span> <span class="n">writeStructure</span><span class="o">.</span><span class="n">sizeleft</span><span class="p">);</span>

<span class="n">curl_easy_setopt</span><span class="p">(</span><span class="n">curl</span><span class="p">,</span> <span class="no">CURLOPT_WRITEFUNCTION</span><span class="p">,</span> <span class="n">write_callback_function</span><span class="p">);</span>
<span class="n">curl_easy_setopt</span><span class="p">(</span><span class="n">curl</span><span class="p">,</span> <span class="no">CURLOPT_WRITEDATA</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">stamp</span><span class="p">);</span>
</code></pre></div>
<p>Finalmente ejecutamos la petición:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">result</span> <span class="o">=</span> <span class="n">curl_easy_perform</span><span class="p">(</span><span class="n">curl</span><span class="p">);</span>
</code></pre></div>
<hr>

<h3 id="obtener-el-timbre">Obtener el timbre</h3>

<p>Para obtener los datos de respuesta del servidor simplemente se necesita lo siguiente:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby">    <span class="n">curl_easy_getinfo</span><span class="p">(</span><span class="n">curl</span><span class="p">,</span> <span class="no">CURLINFO_RESPONSE_CODE</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">response_code</span><span class="p">);</span>
    <span class="n">curl_easy_cleanup</span><span class="p">(</span><span class="n">curl</span><span class="p">);</span>

    <span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;Codigo HTTP: %lu</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">response_code</span><span class="p">);</span>
    <span class="nb">printf</span><span class="p">(</span><span class="s2">&quot;Timbre: %s&quot;</span><span class="p">,</span> <span class="n">stamp</span><span class="p">);</span>  
  <span class="p">}</span>

  <span class="n">curl_global_cleanup</span><span class="p">();</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>Si ejecutamos el código utilizando:</p>

<p><strong>Windows</strong></p>
<div class="highlight"><pre><code class="language-text" data-lang="text">C:\&gt; cl timbrar.c libcurl.lib /I include
C:\&gt; timbrar
</code></pre></div>
<p><strong>Nota:</strong> Se debe utilizar la <strong>Developer Command Prompt</strong> que instala Visual Studio.</p>

<p><strong>Unix/Linux/OSX</strong></p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ gcc timbrar.c -o timbrar -lcurl
$ ./timbrar
</code></pre></div>
<p>Podremos observar que el timbre es devuelto por el servicio en el cuerpo de la respuesta, y al imprimir la variable stamp debe observarse algo similar a lo siguiente:</p>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;tfd:TimbreFiscalDigital</span> 
  <span class="na">xmlns:tfd=</span><span class="s">&quot;http://www.sat.gob.mx/TimbreFiscalDigital&quot;</span> 
  <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.sat.gob.mx/TimbreFiscalDigital http://www.sat.gob.mx/sitio_internet/cfd/TimbreFiscalDigital/TimbreFiscalDigital.xsd&quot;</span> 

  <span class="na">selloSAT=</span><span class="s">&quot;Ae0K1DyTpecq8xZAB8SSCccx5Gzrqr+HaD1tEQ/dFNqobiZDfJ2U9eJ9BRxYn1K6Zw4A0W2PbBs3VUFFasuJHkfw5nLxb+M/hu55Gomhw9OjhKsH0ABnOGa3vQHWPHHDFB9zb4/sMxdUTqEubent8Zvb3nfKaxdgX9BkVFYgd+c=&quot;</span> 
  <span class="na">noCertificadoSAT=</span><span class="s">&quot;20001000000100005761&quot;</span> 
  <span class="na">selloCFD=</span><span class="s">&quot;qTzEwNUDvk/WpeFstpf/FLNmiHMxiL8pDTXGNb+DCFO0Z7SXMZJCim3JAlBw8Astvr0/jiVfo3WdWbaX88cC1l1+iipOLdedbFNHZUmsW86nC1YQHWw0S6mEiGH0ZxGa5KOl/1mrvPlDweeCiyYavNQeEuO1r0/ELobMi07w6ps=&quot;</span> 
  <span class="na">FechaTimbrado=</span><span class="s">&quot;2014-08-27T19:33:42&quot;</span> 
  <span class="na">UUID=</span><span class="s">&quot;e52d9982-1cd1-4b99-aa3c-0f6172d07412&quot;</span> 

  <span class="na">version=</span><span class="s">&quot;1.0&quot;</span><span class="nt">/&gt;</span>
</code></pre></div>
<p>El código de respuesta del servidor que se encuentra en la variable <em>response_code</em> deberá ser <em>200 OK</em> cuando la petición sea exitosa, en caso contrario te invitamos a revisar la <a href="../codigos">Lista de Códigos de Respuesta</a>, que contiene todos los posibles códigos de respuesta del servicio de timbrado y sus posibles soluciones.</p>

<hr>

            </div>
          </div>
        </div>
      </div>
      <div id="sidebar-right" class="span3 sidebar">
    <div class="sidebar-padding">
        <div class=" ">
            <div class="module">

                <h3><a href="/timbre/indice.html">mapa del sitio<span class="diverza-dot">.</span></a></h3>
                <div class="clr"></div>
                <div class="module-content"></div>

                <h3>servicio<span class="diverza-dot">.</span></h3>
                <span class="h3-line"></span>
                <div class="clr"></div>

                <div class="module-content">
                    <ul class="menu">
                        <li class="item-178"><a href="/timbre/endpoints/">endpoints</a></li>
                        <li class="item-178"><a href="/timbre/refid.html">el refID</a></li>
                        <li class="item-178"><a href="/timbre/cfd/timbreWeb.html">cuenta web</a></li>
                        <li class="item-178"><a href="/timbre/cfd/repImpresa.html">representación impresa</a></li>
                    </ul>
                </div>

                <h3>recursos<span class="diverza-dot">.</span></h3>
                <span class="h3-line"></span>
                <div class="clr"></div>

                <div class="module-content">
                    <ul class="menu">
                        <li class="item-178"><a href="/timbre/cfd/">cfdi</a></li>
                        <li class="item-178"><a href="/timbre/cfd/comoGenerarCFDI.html">generar cfdi</a></li>
                        <li class="item-178"><a href="/timbre/recursos/">esquemas y ejemplos</a></li>
                        <li class="item-178"><a href="/timbre/lenguajes/">ejemplos de código</a></li>
                    </ul>
                </div>


                <h3>códigos de respuesta<span class="diverza-dot">.</span></h3>
                <span class="h3-line"></span>
                <div class="clr"></div>

                <div class="module-content">
                    <ul class="menu menu-lines">
                        <li class="item-178"><a href="/timbre/codigos/">emisión y timbrado</a></li>
                        <li class="item-178"><a href="/timbre/codigos/cod_cancelacion.html">cancelación</a></li>
                    </ul>
                </div>
 
                <h3>FAQ's<span class="diverza-dot">.</span></h3>
                <span class="h3-line"></span>
                <div class="clr"></div>
                <div class="module-content">
                    <ul class="menu">
                        <li class="item-178"><a href="/timbre/documentacionServicio/pregFrecuentes.html">preguntas frecuentes</a></li>
                        <li class="item-178"><a href="/timbre/documentacionServicio/errComunes.html">errores comunes</a></li>
                    </ul>               
                </div>
            </div>
            <div class="clr"></div>
        </div>
    </div>
</div>
    </div>
  </div>
</div>
  <style>
    .hero-unit { }
    #body { background: #fff url('/images/content-dev.png') no-repeat 50% 0 ; }
  </style>

  <div id="footer">
	<div class="container">
		<footer>

			<ul class="menu">
				<li class="item-123"><a href="http://www.diverza.com/privacidad">Aviso de privacidad</a></li><li class="item-124"><a href="http://www.diverza.com/terminos">Términos y condiciones</a></li><li class="item-125"><a href="http://www.diverza.com/integrate">Intégrate al equipo</a></li><li class="item-135"><a href="http://www.diverza.com/mi-cuenta">Mi cuenta</a></li></ul>

				<div class="custom">

					<div class="row-fluid">
						<br>
						<div class="span3"></div>

						<div class="span2" style="margin:0px"><a href="http://www.greatplacetowork.com.mx" title="GPTW" class="footer-logo-gptw" style="margin: -20px 0 0 auto;" target="_blank">GPTW</a></div>

						<div class="span2" style="margin:0 6px 0 20px;"><a href="http://www.sat.gob.mx/sitio_internet/asistencia_contribuyente/principiantes/comprobantes_fiscales/66_20006.html" title="SAT" class="footer-logo-sat" style="margin: -20px auto 0 auto;" target="_blank">SAT</a></div>

						<div class="span2" style="margin:0px"><a href="http://www.amexipac.org.mx" title="AMEXIPAC" class="footer-logo-amexipac" style="margin: -20px auto 0 0;" target="_blank">AMEXIPAC</a></div>

						<div class="span2"></div>

						<div class="clr"></div>

						<div style="font-size:10px; margin-top: 5px;">DIVERZA © Copyright.&nbsp;Los nombres y logos de Buzón Fiscal®, Conector Fiscal® y Timbre Fiscal® son marcas registradas de Diverza Información y Análisis, SAPI de CV. Otros nombres y logos son marcas registradas de sus respectivos propietarios. Todo el contenido de este sitio y los documentos para descarga son propiedad intelectual de Diverza Información y Análisis, SAPI de CV.<br> 

							<div class="clr"></div>
							<div style="font-size:12px;margin-top: 5px;text-align: center;">

								<script type="text/javascript">
									<!--
									var prefix = '&#109;a' + 'i&#108;' + '&#116;o';
									var path = 'hr' + 'ef' + '=';
									var addy64856 = 'c&#111;nt&#97;ct&#111;' + '&#64;';
									addy64856 = addy64856 + 'd&#105;v&#101;rz&#97;' + '&#46;' + 'c&#111;m';
									document.write('<a ' + path + '\'' + prefix + ':' + addy64856 + '\'>');
									document.write(addy64856);
									document.write('<\/a>');
									//-->\n </script>
									<span style="display: none;">This email address is being protected from spambots. You need JavaScript enabled to view it.
<script type="text/javascript">
	<!--
	document.write('</');
	document.write('span>');
 //-->
</script></span> &nbsp;&nbsp;&nbsp;| &nbsp;&nbsp;&nbsp;<a href="https://www.diverza.com/servicio-gratuito">acceso al servicio gratuito</a> &nbsp;&nbsp;&nbsp;| &nbsp;&nbsp;&nbsp; 01.800.070.4000</div></div>
</div></div>

</footer>
</div>
</div>
</body>
</html>