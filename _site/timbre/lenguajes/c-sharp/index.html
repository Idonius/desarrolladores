<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <!-- syntax highlighting CSS -->
  <link rel="stylesheet" href="/css/syntax.css">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="/css/main.css">
  <!-- // <script src="http://syssgx.github.io/xml.js/js/xmllint.js"></script> -->
  <!-- // <script src="/scripts/bootstrap.min.js"></script> -->
  	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
	<script>window.jQuery || document.write('<script src="/scripts/jquery.min.js"><\/script>')</script>
	<script src="/scripts/bootstrap.min.js"></script>
<!--<script src="scripts/codemirror.js"></script>-->
    <!--<script src="scripts/searchcursor.js"></script>-->
    <!--<script src="scripts/match-highlighter.js"></script>-->
    <!--<script src="scripts/xml.js"></script>-->
	<!--<script src="scripts/prettify.js"></script>-->
	<!-- <script src="/scripts/xmllint.js"></script> -->
	<!-- // <script src="/scripts/script.js"></script> -->

  <link href="/favicon.ico" rel="shortcut icon" type="image/vnd.microsoft.icon" />

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-286386-31', 'auto');
    ga('send', 'pageview');
  </script>
  <title>C# .NET</title>
</head>

<body class="page-content page-columns-2">
  <a name="top" id="top"></a>
<div id="header-bg">
  <div id="bg-top"><div id="bg-top-left"></div></div>
  <div id="bg-fix"></div>
</div>
<div class="container" id="header">
  <div class="navbar">
    <div class="navbar-inner">
      <div class="container">
        <a id="logo" class="brand icon-logo-off" href="http://diverza.com"></a>
        <div class="nav-collapse">

          <ul class="menu nav">
            <li class="item-101">
              <a href="">Portada</a>
            </li>
            <li class="item-102">
              <a href="http://www.diverza.com/historia" >historia</a>
            </li>
            <li class="item-103">
              <a href="http://blog.diverza.com" >blog</a>
            </li>
            <li class="item-104">
              <a href="http://desarrolladores.diverza.com" id="stamp-navitem-selected">ecosistema</a>
            </li>
            <li class="item-105">
              <a href="http://www.diverza.com/contacto" >contacto</a>
            </li>
            <li class="item-106">
              <a href="http://www.diverza.com/soporte" >soporte</a>
            </li>
            <li class="item-107">
            <a href="http://www.diverza.com/acceso" >acceso</a>
            </li>
            <li id="colors-bar">
              <div class="color-bar color-bar-blue"></div>
              <div class="color-bar color-bar-yellow"></div>
              <div class="color-bar color-bar-green"></div>
              <div class="color-bar color-bar-red"></div>
            </li></ul>
          </div>
          <div class="nav-social">
            <ul class="menu-social">
              <li class="item-131"><a class="rss" href="http://feeds.feedburner.com/blog-diverza">RSS</a></li><li class="item-130"><a class="googleplus" href="https://plus.google.com/u/0/100935627964150268592/posts">Google Plus</a></li><li class="item-129"><a class="youtube" href="http://www.youtube.com/user/DiverzaTv?feature=mhee">YouTube</a></li><li class="item-128"><a class="facebook" href="http://www.facebook.com/pages/Diverza/350358341644324">Facebook</a></li><li class="item-127"><a class="twitter" href="http://twitter.com/diverza">Twitter</a></li></ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="container" id="header-brand-dummy"></div>
    <div id="header-brand">
      <div class="navbar container">
        <div class="navbar-inner">
          <div class="container">
            <div class="row">

              <div class="span2 nav-welcome ">
                <a href="/"><span class="welcome">desarrolladores<span class="diverza-dot">.</span></span></a>
              </div>

              <div class="nav-collapse-brand" id="menu-sub">
                <ul class="menu nav">
                  <li class="item-102" id="stamp-menu-item">
                    <a href="/timbre/">timbre fiscal</a>
                  </li>
                  <li class="item-103" id="conector-menu-item">
                    <a href="/conector/">conector fiscal</a>
                  </li>
                  <li class="item-104" id="docs-menu-item">
                    <a href="/documentos/">documentos</a>
                  </li>
                  <li class="item-105">
                    <a href="https://groups.google.com/forum/#!forum/diverza" target="_blank">grupos</a>
                  </li>
                  <li class="item-106">
                    <a href="https://github.com/diverza/desarrolladores" target="_blank">github</a>
                  </li>
                </ul>
              </div>
              <div class="nav-account">
                <div class="module">
                  <div class="custom">01.800.070.4000</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

  <style>
  #stamp-menu-item { color: #fff !important;
    background: #ddd;
    -webkit-box-shadow: inset 2px 2px 2px rgba(0, 0, 0, 0.25);
    -moz-box-shadow: inset 2px 2px 2px rgba(0, 0, 0, 0.25);
    -o-box-shadow: inset 2px 2px 2px rgba(0, 0, 0, 0.25);
    -ms-box-shadow: inset 2px 2px 2px rgba(0, 0, 0, 0.25);
    box-shadow: inset 2px 2px 2px rgba(0, 0, 0, 0.25);
    -webkit-border-radius: 20px;
    -moz-border-radius: 20px;
    -o-border-radius: 20px;
    -ms-border-radius: 20px;
    border-radius: 20px;
    text-shadow: 1px 1px rgba(0, 0, 0, 0.20);
    height: 35px;
    margin-top: 2px;
  }
</style>

<div id="body">
  <div class="container">
    <div id="main" class="row">
      <div id="content" class="span12">
        <div id="system-message-container">
        </div>
        <div id="component">
          <div class="item-pagepage-history">
            <div class="clr"></div>
            <div class="article-content-text">
              <h1>C# .NET<span class="diverza-dot">.</span></h1>
              <span class="h1-line"></span>
              <div class="clr">&nbsp;</div>
              <p>La siguiente guía comprende la conexión con el servicio de timbrado utilizando Visual Studio 2010 o superior.</p>

<p>El código de esta guía se encuentra disponible para su descarga en el <a href="https://github.com/diverza/desarrolladores/tree/master/Timbre/C%23">repositorio de ejemplos para Timbre Fiscal.</a></p>

<hr>

<h2 id="generar-timbre">Generar Timbre</h2>

<p>Para generar un timbre utilizando el servidor de pruebas es necesario tener los siguientes datos del servidor a la mano:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"> Servidor de prueba: https://staging.diverza.com/stamp
 Token de prueba: ABCD1234
 Metodo HTTP: POST
 Header HTTP: x-auth-token
</code></pre></div>
<p>Así como también el CFDI de prueba que usaremos en este ejercicio:</p>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;cfdi:Comprobante</span> 
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.sat.gob.mx/cfd/3 http://www.sat.gob.mx/sitio_internet/cfd/3/cfdv32.xsd&quot;</span> 
    <span class="na">xmlns:cfdi=</span><span class="s">&quot;http://www.sat.gob.mx/cfd/3&quot;</span> 
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> 
    <span class="na">xmlns:xs=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema&quot;</span>
    <span class="na">LugarExpedicion=</span><span class="s">&quot;D.F.,MEXICO&quot;</span> 
    <span class="na">NumCtaPago=</span><span class="s">&quot;DESCONOCIDO&quot;</span> 
    <span class="na">formaDePago=</span><span class="s">&quot;PAGO EN UNA SOLA EXHIBICION&quot;</span> 
    <span class="na">metodoDePago=</span><span class="s">&quot;TRANSFERENCIA ELECTRONICA&quot;</span>
    <span class="na">subTotal=</span><span class="s">&quot;1000.00&quot;</span> 
    <span class="na">total=</span><span class="s">&quot;1160.00&quot;</span> 
    <span class="na">fecha=</span><span class="s">&quot;2013-12-02T22:18:24&quot;</span> 
    <span class="na">certificado=</span><span class="s">&quot;MIIEdDCCA1ygAwIBAgIUMjAwMDEwMDAwMDAxMDAwMDU4NjcwDQYJKoZIhvcNAQEFBQAwggFvMRgwFgYDVQQDDA9BLkMuIGRlIHBydWViYXMxLzAtBgNVBAoMJlNlcnZpY2lvIGRlIEFkbWluaXN0cmFjacOzbiBUcmlidXRhcmlhMTgwNgYDVQQLDC9BZG1pbmlzdHJhY2nDs24gZGUgU2VndXJpZGFkIGRlIGxhIEluZm9ybWFjacOzbjEpMCcGCSqGSIb3DQEJARYaYXNpc25ldEBwcnVlYmFzLnNhdC5nb2IubXgxJjAkBgNVBAkMHUF2LiBIaWRhbGdvIDc3LCBDb2wuIEd1ZXJyZXJvMQ4wDAYDVQQRDAUwNjMwMDELMAkGA1UEBhMCTVgxGTAXBgNVBAgMEERpc3RyaXRvIEZlZGVyYWwxEjAQBgNVBAcMCUNveW9hY8OhbjEVMBMGA1UELRMMU0FUOTcwNzAxTk4zMTIwMAYJKoZIhvcNAQkCDCNSZXNwb25zYWJsZTogSMOpY3RvciBPcm5lbGFzIEFyY2lnYTAeFw0xMjA3MjcxNzAyMDBaFw0xNjA3MjcxNzAyMDBaMIHbMSkwJwYDVQQDEyBBQ0NFTSBTRVJWSUNJT1MgRU1QUkVTQVJJQUxFUyBTQzEpMCcGA1UEKRMgQUNDRU0gU0VSVklDSU9TIEVNUFJFU0FSSUFMRVMgU0MxKTAnBgNVBAoTIEFDQ0VNIFNFUlZJQ0lPUyBFTVBSRVNBUklBTEVTIFNDMSUwIwYDVQQtExxBQUEwMTAxMDFBQUEgLyBIRUdUNzYxMDAzNFMyMR4wHAYDVQQFExUgLyBIRUdUNzYxMDAzTURGUk5OMDkxETAPBgNVBAsTCFVuaWRhZCAxMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC2TTQSPONBOVxpXv9wLYo8jezBrb34i/tLx8jGdtyy27BcesOav2c1NS/Gdv10u9SkWtwdy34uRAVe7H0a3VMRLHAkvp2qMCHaZc4T8k47Jtb9wrOEh/XFS8LgT4y5OQYo6civfXXdlvxWU/gdM/e6I2lg6FGorP8H4GPAJ/qCNwIDAQABox0wGzAMBgNVHRMBAf8EAjAAMAsGA1UdDwQEAwIGwDANBgkqhkiG9w0BAQUFAAOCAQEATxMecTpMbdhSHo6KVUg4QVF4Op2IBhiMaOrtrXBdJgzGotUFcJgdBCMjtTZXSlq1S4DG1jr8p4NzQlzxsdTxaB8nSKJ4KEMgIT7E62xRUj15jI49qFz7f2uMttZLNThipunsN/NF1XtvESMTDwQFvas/Ugig6qwEfSZc0MDxMpKLEkEePmQwtZD+zXFSMVa6hmOu4M+FzGiRXbj4YJXn9Myjd8xbL/c+9UIcrYoZskxDvMxc6/6M3rNNDY3OFhBK+V/sPMzWWGt8S1yjmtPfXgFs1t65AZ2hcTwTAuHrKwDatJ1ZPfa482ZBROAAX1waz7WwXp0gso7sDCm2/yUVww==&quot;</span> 
    <span class="na">noCertificado=</span><span class="s">&quot;20001000000100005867&quot;</span> 
    <span class="na">sello=</span><span class="s">&quot;qTzEwNUDvk/WpeFstpf/FLNmiHMxiL8pDTXGNb+DCFO0Z7SXMZJCim3JAlBw8Astvr0/jiVfo3WdWbaX88cC1l1+iipOLdedbFNHZUmsW86nC1YQHWw0S6mEiGH0ZxGa5KOl/1mrvPlDweeCiyYavNQeEuO1r0/ELobMi07w6ps=&quot;</span> 
    <span class="na">tipoDeComprobante=</span><span class="s">&quot;ingreso&quot;</span>
    <span class="na">version=</span><span class="s">&quot;3.2&quot;</span> <span class="nt">&gt;</span>
    <span class="nt">&lt;cfdi:Emisor</span> <span class="na">nombre=</span><span class="s">&quot;EMPRESA DEMO&quot;</span> <span class="na">rfc=</span><span class="s">&quot;AAA010101AAA&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;cfdi:DomicilioFiscal</span> <span class="na">codigoPostal=</span><span class="s">&quot;34343&quot;</span> <span class="na">pais=</span><span class="s">&quot;MEXICO&quot;</span> <span class="na">estado=</span><span class="s">&quot;DISTRITO FEDERAL&quot;</span> <span class="na">municipio=</span><span class="s">&quot;BENITO JUAREZ&quot;</span> <span class="na">calle=</span><span class="s">&quot;REFORMA&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;cfdi:RegimenFiscal</span> <span class="na">Regimen=</span><span class="s">&quot;PERSONA FISCA&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/cfdi:Emisor&gt;</span>
    <span class="nt">&lt;cfdi:Receptor</span> <span class="na">nombre=</span><span class="s">&quot;PUBLICO EN GENERAL&quot;</span> <span class="na">rfc=</span><span class="s">&quot;XAXX010101000&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;cfdi:Domicilio</span> <span class="na">pais=</span><span class="s">&quot;MEXICO&quot;</span> <span class="na">calle=</span><span class="s">&quot;INSURGENTES&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/cfdi:Receptor&gt;</span>
    <span class="nt">&lt;cfdi:Conceptos&gt;</span>
        <span class="nt">&lt;cfdi:Concepto</span> <span class="na">importe=</span><span class="s">&quot;1000.00&quot;</span> <span class="na">valorUnitario=</span><span class="s">&quot;1000.00&quot;</span> <span class="na">descripcion=</span><span class="s">&quot;PZA&quot;</span> <span class="na">unidad=</span><span class="s">&quot;CANT&quot;</span> <span class="na">cantidad=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/cfdi:Conceptos&gt;</span>
    <span class="nt">&lt;cfdi:Impuestos&gt;</span>
        <span class="nt">&lt;cfdi:Traslados&gt;</span>
            <span class="nt">&lt;cfdi:Traslado</span> <span class="na">importe=</span><span class="s">&quot;160.00&quot;</span> <span class="na">tasa=</span><span class="s">&quot;160.00&quot;</span> <span class="na">impuesto=</span><span class="s">&quot;IVA&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/cfdi:Traslados&gt;</span>
    <span class="nt">&lt;/cfdi:Impuestos&gt;</span>
    <span class="nt">&lt;cfdi:Addenda/&gt;</span>
<span class="nt">&lt;/cfdi:Comprobante&gt;</span>
</code></pre></div>
<p><strong>Nota:</strong> Para conocer más acerca de como construir un CFDI, te recomendamos visitar la siguiente guía: <a href="/timbre/cfd/">Como generar un CFDI.</a></p>

<hr>

<h3 id="inicio">Inicio</h3>

<p>Primeramente necesitamos crear un nuevo proyecto en Visual Studio 2010 de tipo <strong>C# Console Application</strong>,  una vez realizado esto necesitamos abrir el archivo <strong>Program.cs</strong>, que debe ser algo similar a lo siguiente:</p>
<div class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">Timbrar</span>
<span class="p">{</span>
    <span class="k">class</span> <span class="nc">Program</span>
    <span class="p">{</span>
        <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>El primer paso es importar una nueva libreria agregando la siguiente linea al inicio del archivo:</p>
<div class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="k">using</span> <span class="nn">System.Net</span><span class="p">;</span>
</code></pre></div>
<p>Ahora deberemos editar el metodo Main, agregando por facilidad nuestro CFDI a timbrar en una variable:</p>
<div class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="kt">string</span> <span class="n">cfd</span> <span class="p">=</span> <span class="s">@&quot;&lt;?xml version=&quot;&quot;1.0&quot;&quot; encoding=&quot;&quot;UTF-8&quot;&quot;?&gt;</span>
<span class="s">                           &lt;cfdi:Comprobante </span>
<span class="s">                                xsi:schemaLocation=&quot;&quot;http://www.sat.gob.mx/cfd/3 http://www.sat.gob.mx/sitio_internet/cfd/3/cfdv32.xsd&quot;&quot; </span>
<span class="s">                                xmlns:cfdi=&quot;&quot;http://www.sat.gob.mx/cfd/3&quot;&quot; </span>
<span class="s">                                xmlns:xsi=&quot;&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&quot; </span>
<span class="s">                                xmlns:xs=&quot;&quot;http://www.w3.org/2001/XMLSchema&quot;&quot;</span>
<span class="s">                                LugarExpedicion=&quot;&quot;D.F.,MEXICO&quot;&quot; </span>
<span class="s">                                NumCtaPago=&quot;&quot;DESCONOCIDO&quot;&quot; </span>
<span class="s">                                formaDePago=&quot;&quot;PAGO EN UNA SOLA EXHIBICION&quot;&quot; </span>
<span class="s">                                metodoDePago=&quot;&quot;TRANSFERENCIA ELECTRONICA&quot;&quot;</span>
<span class="s">                                subTotal=&quot;&quot;1000.00&quot;&quot; </span>
<span class="s">                                total=&quot;&quot;1160.00&quot;&quot; </span>
<span class="s">                                fecha=&quot;&quot;2013-12-02T22:18:24&quot;&quot; </span>
<span class="s">                                certificado=&quot;&quot;MIIEdDCCA1ygAwIBAgIUMjAwMDEwMDAwMDAxMDAwMDU4NjcwDQYJKoZIhvcNAQEFBQAwggFvMRgwFgYDVQQDDA9BLkMuIGRlIHBydWViYXMxLzAtBgNVBAoMJlNlcnZpY2lvIGRlIEFkbWluaXN0cmFjacOzbiBUcmlidXRhcmlhMTgwNgYDVQQLDC9BZG1pbmlzdHJhY2nDs24gZGUgU2VndXJpZGFkIGRlIGxhIEluZm9ybWFjacOzbjEpMCcGCSqGSIb3DQEJARYaYXNpc25ldEBwcnVlYmFzLnNhdC5nb2IubXgxJjAkBgNVBAkMHUF2LiBIaWRhbGdvIDc3LCBDb2wuIEd1ZXJyZXJvMQ4wDAYDVQQRDAUwNjMwMDELMAkGA1UEBhMCTVgxGTAXBgNVBAgMEERpc3RyaXRvIEZlZGVyYWwxEjAQBgNVBAcMCUNveW9hY8OhbjEVMBMGA1UELRMMU0FUOTcwNzAxTk4zMTIwMAYJKoZIhvcNAQkCDCNSZXNwb25zYWJsZTogSMOpY3RvciBPcm5lbGFzIEFyY2lnYTAeFw0xMjA3MjcxNzAyMDBaFw0xNjA3MjcxNzAyMDBaMIHbMSkwJwYDVQQDEyBBQ0NFTSBTRVJWSUNJT1MgRU1QUkVTQVJJQUxFUyBTQzEpMCcGA1UEKRMgQUNDRU0gU0VSVklDSU9TIEVNUFJFU0FSSUFMRVMgU0MxKTAnBgNVBAoTIEFDQ0VNIFNFUlZJQ0lPUyBFTVBSRVNBUklBTEVTIFNDMSUwIwYDVQQtExxBQUEwMTAxMDFBQUEgLyBIRUdUNzYxMDAzNFMyMR4wHAYDVQQFExUgLyBIRUdUNzYxMDAzTURGUk5OMDkxETAPBgNVBAsTCFVuaWRhZCAxMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC2TTQSPONBOVxpXv9wLYo8jezBrb34i/tLx8jGdtyy27BcesOav2c1NS/Gdv10u9SkWtwdy34uRAVe7H0a3VMRLHAkvp2qMCHaZc4T8k47Jtb9wrOEh/XFS8LgT4y5OQYo6civfXXdlvxWU/gdM/e6I2lg6FGorP8H4GPAJ/qCNwIDAQABox0wGzAMBgNVHRMBAf8EAjAAMAsGA1UdDwQEAwIGwDANBgkqhkiG9w0BAQUFAAOCAQEATxMecTpMbdhSHo6KVUg4QVF4Op2IBhiMaOrtrXBdJgzGotUFcJgdBCMjtTZXSlq1S4DG1jr8p4NzQlzxsdTxaB8nSKJ4KEMgIT7E62xRUj15jI49qFz7f2uMttZLNThipunsN/NF1XtvESMTDwQFvas/Ugig6qwEfSZc0MDxMpKLEkEePmQwtZD+zXFSMVa6hmOu4M+FzGiRXbj4YJXn9Myjd8xbL/c+9UIcrYoZskxDvMxc6/6M3rNNDY3OFhBK+V/sPMzWWGt8S1yjmtPfXgFs1t65AZ2hcTwTAuHrKwDatJ1ZPfa482ZBROAAX1waz7WwXp0gso7sDCm2/yUVww==&quot;&quot; </span>
<span class="s">                                noCertificado=&quot;&quot;20001000000100005867&quot;&quot; </span>
<span class="s">                                sello=&quot;&quot;qTzEwNUDvk/WpeFstpf/FLNmiHMxiL8pDTXGNb+DCFO0Z7SXMZJCim3JAlBw8Astvr0/jiVfo3WdWbaX88cC1l1+iipOLdedbFNHZUmsW86nC1YQHWw0S6mEiGH0ZxGa5KOl/1mrvPlDweeCiyYavNQeEuO1r0/ELobMi07w6ps=&quot;&quot; </span>
<span class="s">                                tipoDeComprobante=&quot;&quot;ingreso&quot;&quot;</span>
<span class="s">                                version=&quot;&quot;3.2&quot;&quot; &gt;</span>
<span class="s">                                &lt;cfdi:Emisor nombre=&quot;&quot;EMPRESA DEMO&quot;&quot; rfc=&quot;&quot;AAA010101AAA&quot;&quot;&gt;</span>
<span class="s">                                    &lt;cfdi:DomicilioFiscal codigoPostal=&quot;&quot;34343&quot;&quot; pais=&quot;&quot;MEXICO&quot;&quot; estado=&quot;&quot;DISTRITO FEDERAL&quot;&quot; municipio=&quot;&quot;BENITO JUAREZ&quot;&quot; calle=&quot;&quot;REFORMA&quot;&quot;/&gt;</span>
<span class="s">                                    &lt;cfdi:RegimenFiscal Regimen=&quot;&quot;PERSONA FISCA&quot;&quot;/&gt;</span>
<span class="s">                                &lt;/cfdi:Emisor&gt;</span>
<span class="s">                                &lt;cfdi:Receptor nombre=&quot;&quot;PUBLICO EN GENERAL&quot;&quot; rfc=&quot;&quot;XAXX010101000&quot;&quot;&gt;</span>
<span class="s">                                    &lt;cfdi:Domicilio pais=&quot;&quot;MEXICO&quot;&quot; calle=&quot;&quot;INSURGENTES&quot;&quot;/&gt;</span>
<span class="s">                                &lt;/cfdi:Receptor&gt;</span>
<span class="s">                                &lt;cfdi:Conceptos&gt;</span>
<span class="s">                                    &lt;cfdi:Concepto importe=&quot;&quot;1000.00&quot;&quot; valorUnitario=&quot;&quot;1000.00&quot;&quot; descripcion=&quot;&quot;PZA&quot;&quot; unidad=&quot;&quot;CANT&quot;&quot; cantidad=&quot;&quot;1&quot;&quot;/&gt;</span>
<span class="s">                                &lt;/cfdi:Conceptos&gt;</span>
<span class="s">                                &lt;cfdi:Impuestos&gt;</span>
<span class="s">                                    &lt;cfdi:Traslados&gt;</span>
<span class="s">                                        &lt;cfdi:Traslado importe=&quot;&quot;160.00&quot;&quot; tasa=&quot;&quot;160.00&quot;&quot; impuesto=&quot;&quot;IVA&quot;&quot;/&gt;</span>
<span class="s">                                    &lt;/cfdi:Traslados&gt;</span>
<span class="s">                                &lt;/cfdi:Impuestos&gt;</span>
<span class="s">                                &lt;cfdi:Addenda/&gt;</span>
<span class="s">                            &lt;/cfdi:Comprobante&gt;&quot;</span><span class="p">;</span>
</code></pre></div>
<hr>

<h3 id="petición-http">Petición HTTP</h3>

<p>Para realizar una petición HTTP desde .NET es necesario tener una instancia del objeto <strong>Web Client</strong> lo cual se realiza de la siguiente manera:</p>
<div class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="k">try</span>
<span class="p">{</span>
  <span class="n">WebClient</span> <span class="n">webClient</span> <span class="p">=</span> <span class="k">new</span> <span class="n">WebClient</span><span class="p">();</span>
</code></pre></div>
<p>Por motivos de seguridad es necesario que agreguemos un token de seguridad a la petición, en esta guía utilizaremos el de prueba <strong>ABCD1234</strong> y este deberá ser cambiado cuando deseemos pasar el código a producción:</p>
<div class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="n">webClient</span><span class="p">.</span><span class="n">Headers</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="s">&quot;x-auth-token&quot;</span><span class="p">,</span> <span class="s">&quot;ABCD1234&quot;</span><span class="p">);</span>
<span class="n">webClient</span><span class="p">.</span><span class="n">Encoding</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">Text</span><span class="p">.</span><span class="n">Encoding</span><span class="p">.</span><span class="n">GetEncoding</span><span class="p">(</span><span class="s">&quot;UTF-8&quot;</span><span class="p">);</span>
</code></pre></div>
<p>Finalmente ejecutamos la petición de timbrado indicando la URL del servicio de timbrado, el metodo HTTP POST y el CFDI que deseamos timbrar:</p>
<div class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="kt">string</span> <span class="n">stamp</span> <span class="p">=</span> <span class="n">webClient</span><span class="p">.</span><span class="n">UploadString</span><span class="p">(</span><span class="s">&quot;https://staging.diverza.com/stamp&quot;</span><span class="p">,</span> <span class="s">&quot;POST&quot;</span><span class="p">,</span> <span class="n">cfd</span><span class="p">);</span>
</code></pre></div>
<hr>

<h3 id="obtener-el-timbre">Obtener el timbre</h3>

<p>Para obtener los datos de respuesta del servidor simplemente se necesita lo siguiente:</p>
<div class="highlight"><pre><code class="language-c#" data-lang="c#">  <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">&quot;Timbre: {0}&quot;</span><span class="p">,</span> <span class="n">stamp</span><span class="p">));</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="n">WebException</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
  <span class="cm">/* En caso de error podemos obtener el codigo de estatus de la petición consultando la excepción que</span>
<span class="cm">  // arrojada por la instancia del web client. */</span>
  <span class="n">HttpWebResponse</span> <span class="n">httpWebResponse</span> <span class="p">=</span> <span class="p">((</span><span class="n">HttpWebResponse</span><span class="p">)</span><span class="n">e</span><span class="p">.</span><span class="n">Response</span><span class="p">);</span>

  <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">&quot;Codigo HTTP: {0} {1}&quot;</span><span class="p">,</span> <span class="n">httpWebResponse</span><span class="p">.</span><span class="n">StatusCode</span><span class="p">,</span> <span class="n">httpWebResponse</span><span class="p">.</span><span class="n">StatusDescription</span><span class="p">));</span>
<span class="p">}</span>

<span class="n">Console</span><span class="p">.</span><span class="n">ReadLine</span><span class="p">();</span>
</code></pre></div>
<p>Si ejecutamos el código utilizando:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&quot;Start Debugging&quot; desde el menu Debug o F5
</code></pre></div>
<p>Podremos observar que el timbre es devuelto por el servicio en el cuerpo de la respuesta, y al imprimir la variable stamp debe observarse algo similar a lo siguiente:</p>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;tfd:TimbreFiscalDigital</span> 
  <span class="na">xmlns:tfd=</span><span class="s">&quot;http://www.sat.gob.mx/TimbreFiscalDigital&quot;</span> 
  <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.sat.gob.mx/TimbreFiscalDigital http://www.sat.gob.mx/sitio_internet/cfd/TimbreFiscalDigital/TimbreFiscalDigital.xsd&quot;</span> 

  <span class="na">selloSAT=</span><span class="s">&quot;Ae0K1DyTpecq8xZAB8SSCccx5Gzrqr+HaD1tEQ/dFNqobiZDfJ2U9eJ9BRxYn1K6Zw4A0W2PbBs3VUFFasuJHkfw5nLxb+M/hu55Gomhw9OjhKsH0ABnOGa3vQHWPHHDFB9zb4/sMxdUTqEubent8Zvb3nfKaxdgX9BkVFYgd+c=&quot;</span> 
  <span class="na">noCertificadoSAT=</span><span class="s">&quot;20001000000100005761&quot;</span> 
  <span class="na">selloCFD=</span><span class="s">&quot;qTzEwNUDvk/WpeFstpf/FLNmiHMxiL8pDTXGNb+DCFO0Z7SXMZJCim3JAlBw8Astvr0/jiVfo3WdWbaX88cC1l1+iipOLdedbFNHZUmsW86nC1YQHWw0S6mEiGH0ZxGa5KOl/1mrvPlDweeCiyYavNQeEuO1r0/ELobMi07w6ps=&quot;</span> 
  <span class="na">FechaTimbrado=</span><span class="s">&quot;2014-08-27T19:33:42&quot;</span> 
  <span class="na">UUID=</span><span class="s">&quot;e52d9982-1cd1-4b99-aa3c-0f6172d07412&quot;</span> 

  <span class="na">version=</span><span class="s">&quot;1.0&quot;</span><span class="nt">/&gt;</span>
</code></pre></div>
<p>En caso de que la petición no sea exitosa podremos obtener el codigo de error del servidor a traves de la excepción, puedes revisar todos los posibles códigos de respuesta y sus posibles soluciones desde la <a href="../codigos">Lista de Códigos de Respuesta</a>.</p>

<hr>

            </div>
          </div>
        </div>
      </div>
      <div id="sidebar-right" class="span3 sidebar">
    <div class="sidebar-padding">
        <div class=" ">
            <div class="module">

                <h3><a href="/timbre/indice.html">mapa del sitio<span class="diverza-dot">.</span></a></h3>
                <div class="clr"></div>
                <div class="module-content"></div>

                <h3>servicio<span class="diverza-dot">.</span></h3>
                <span class="h3-line"></span>
                <div class="clr"></div>

                <div class="module-content">
                    <ul class="menu">
                        <li class="item-178"><a href="/timbre/endpoints/">endpoints</a></li>
                        <li class="item-178"><a href="/timbre/refid.html">el refID</a></li>
                        <li class="item-178"><a href="/timbre/cfd/timbreWeb.html">cuenta web</a></li>
                        <li class="item-178"><a href="/timbre/cfd/repImpresa.html">representación impresa</a></li>
                    </ul>
                </div>

                <h3>recursos<span class="diverza-dot">.</span></h3>
                <span class="h3-line"></span>
                <div class="clr"></div>

                <div class="module-content">
                    <ul class="menu">
                        <li class="item-178"><a href="/timbre/cfd/">cfdi</a></li>
                        <li class="item-178"><a href="/timbre/cfd/comoGenerarCFDI.html">generar cfdi</a></li>
                        <li class="item-178"><a href="/timbre/recursos/">esquemas y ejemplos</a></li>
                        <li class="item-178"><a href="/timbre/lenguajes/">ejemplos de código</a></li>
                    </ul>
                </div>


                <h3>códigos de respuesta<span class="diverza-dot">.</span></h3>
                <span class="h3-line"></span>
                <div class="clr"></div>

                <div class="module-content">
                    <ul class="menu menu-lines">
                        <li class="item-178"><a href="/timbre/codigos/">emisión y timbrado</a></li>
                        <li class="item-178"><a href="/timbre/codigos/cod_cancelacion.html">cancelación</a></li>
                    </ul>
                </div>
 
                <h3>FAQ's<span class="diverza-dot">.</span></h3>
                <span class="h3-line"></span>
                <div class="clr"></div>
                <div class="module-content">
                    <ul class="menu">
                        <li class="item-178"><a href="/timbre/documentacionServicio/pregFrecuentes.html">preguntas frecuentes</a></li>
                        <li class="item-178"><a href="/timbre/documentacionServicio/errComunes.html">errores comunes</a></li>
                    </ul>               
                </div>
            </div>
            <div class="clr"></div>
        </div>
    </div>
</div>
    </div>
  </div>
</div>
  <style>
    .hero-unit { }
    #body { background: #fff url('/images/content-dev.png') no-repeat 50% 0 ; }
  </style>

  <div id="footer">
	<div class="container">
		<footer>

			<ul class="menu">
				<li class="item-123"><a href="http://www.diverza.com/privacidad">Aviso de privacidad</a></li><li class="item-124"><a href="http://www.diverza.com/terminos">Términos y condiciones</a></li><li class="item-125"><a href="http://www.diverza.com/integrate">Intégrate al equipo</a></li><li class="item-135"><a href="http://www.diverza.com/mi-cuenta">Mi cuenta</a></li></ul>

				<div class="custom">

					<div class="row-fluid">
						<br>
						<div class="span3"></div>

						<div class="span2" style="margin:0px"><a href="http://www.greatplacetowork.com.mx" title="GPTW" class="footer-logo-gptw" style="margin: -20px 0 0 auto;" target="_blank">GPTW</a></div>

						<div class="span2" style="margin:0 6px 0 20px;"><a href="http://www.sat.gob.mx/sitio_internet/asistencia_contribuyente/principiantes/comprobantes_fiscales/66_20006.html" title="SAT" class="footer-logo-sat" style="margin: -20px auto 0 auto;" target="_blank">SAT</a></div>

						<div class="span2" style="margin:0px"><a href="http://www.amexipac.org.mx" title="AMEXIPAC" class="footer-logo-amexipac" style="margin: -20px auto 0 0;" target="_blank">AMEXIPAC</a></div>

						<div class="span2"></div>

						<div class="clr"></div>

						<div style="font-size:10px; margin-top: 5px;">DIVERZA © Copyright.&nbsp;Los nombres y logos de Buzón Fiscal®, Conector Fiscal® y Timbre Fiscal® son marcas registradas de Diverza Información y Análisis, SAPI de CV. Otros nombres y logos son marcas registradas de sus respectivos propietarios. Todo el contenido de este sitio y los documentos para descarga son propiedad intelectual de Diverza Información y Análisis, SAPI de CV.<br> 

							<div class="clr"></div>
							<div style="font-size:12px;margin-top: 5px;text-align: center;">

								<script type="text/javascript">
									<!--
									var prefix = '&#109;a' + 'i&#108;' + '&#116;o';
									var path = 'hr' + 'ef' + '=';
									var addy64856 = 'c&#111;nt&#97;ct&#111;' + '&#64;';
									addy64856 = addy64856 + 'd&#105;v&#101;rz&#97;' + '&#46;' + 'c&#111;m';
									document.write('<a ' + path + '\'' + prefix + ':' + addy64856 + '\'>');
									document.write(addy64856);
									document.write('<\/a>');
									//-->\n </script>
									<span style="display: none;">This email address is being protected from spambots. You need JavaScript enabled to view it.
<script type="text/javascript">
	<!--
	document.write('</');
	document.write('span>');
 //-->
</script></span> &nbsp;&nbsp;&nbsp;| &nbsp;&nbsp;&nbsp;<a href="https://www.diverza.com/servicio-gratuito">acceso al servicio gratuito</a> &nbsp;&nbsp;&nbsp;| &nbsp;&nbsp;&nbsp; 01.800.070.4000</div></div>
</div></div>

</footer>
</div>
</div>
</body>
</html>